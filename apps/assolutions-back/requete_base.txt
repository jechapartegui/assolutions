CREATE TABLE IF NOT EXISTS `member_project` (
  `member_id` int NOT NULL,
  `project_id` int NOT NULL,
  PRIMARY KEY (`member_id`, `project_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb3;

-- Insertion des données depuis la table riders
INSERT INTO `member_project` (`member_id`, `project_id`)
SELECT `id`, `project_id` FROM `riders`;

ALTER TABLE `projet_login` CHANGE `password` `password` VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL;
ALTER TABLE `projet_login` ADD `login` VARCHAR(100) NOT NULL AFTER `activation_token`;

DROP TABLE IF EXISTS `gestionnaire_projet`;
CREATE TABLE IF NOT EXISTS `gestionnaire_projet` (
  `project_id` int NOT NULL,
  `rider_id` int NOT NULL,
  PRIMARY KEY (`project_id`,`rider_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb3;
COMMIT;

ALTER TABLE `professeur_saison`
  DROP `taux_horaire`,
  DROP `token`,
  DROP `date_token`;

  ALTER TABLE `document` ADD `objet_id` INT NOT NULL AFTER `titre`, ADD `objet_type` VARCHAR(25) NOT NULL AFTER `objet_id`, ADD `typedoc` VARCHAR(25) NOT NULL AFTER `objet_type`;

'ajouter mimetype string
ALTER TABLE `seance` ADD `nb_essai_possible` INT(10) NULL ;
  ALTER TABLE `seance` DROP `notes`;


SELECT setval(
  pg_get_serial_sequence('groupes', 'id'), -- table, colonne id
  COALESCE((SELECT MAX(id) FROM groupes), 0) + 1,
  false
);

mot de passe appli : emyy djxe qudl fxkg

DELETE FROM inscription_seance a
USING inscription_seance b
WHERE 
    a.personne_id = b.personne_id
    AND a.seance_id = b.seance_id
    AND a.id > b.id;

VERSION 2.0 AsSolutions
INSERT INTO public.contacts
  (object_type, object_id, contact_type, contact_value, diffusion, contact_list, info, pref)
SELECT
  'rider' AS object_type,
  p.id    AS object_id,
  (elem->>'Type')  AS contact_type,
  (elem->>'Value') AS contact_value,
  TRUE AS diffusion,
  'liste_contact' AS contact_list,
  NULL AS info,
  COALESCE((elem->>'Pref')::boolean, FALSE) AS pref
FROM public.personne p
CROSS JOIN LATERAL jsonb_array_elements(
  CASE
    WHEN p.contacts IS NULL THEN '[]'::jsonb
    -- si contacts est déjà json/jsonb
    WHEN pg_typeof(p.contacts)::text IN ('json', 'jsonb') THEN p.contacts::jsonb
    -- si contacts est du texte JSON
    ELSE p.contacts::jsonb
  END
) elem
WHERE (elem->>'Value') IS NOT NULL
  AND (elem->>'Value') <> '';


puis 

INSERT INTO public.contacts
  (object_type, object_id, contact_type, contact_value, diffusion, contact_list, info, pref)
SELECT
  'rider' AS object_type,
  p.id    AS object_id,
  (elem->>'Type')  AS contact_type,
  (elem->>'Value') AS contact_value,
  TRUE AS diffusion,
  'liste_contact_prevenir' AS contact_list,
  NULL AS info,
  COALESCE((elem->>'Pref')::boolean, FALSE) AS pref
FROM public.personne p
CROSS JOIN LATERAL jsonb_array_elements(
  CASE
    WHEN p.contacts_prevenir IS NULL THEN '[]'::jsonb
    WHEN pg_typeof(p.contacts_prevenir)::text IN ('json', 'jsonb') THEN p.contacts_prevenir::jsonb
    ELSE p.contacts_prevenir::jsonb
  END
) elem
WHERE (elem->>'Value') IS NOT NULL
  AND (elem->>'Value') <> '';
