<div *ngIf="uiLock" class="ui-lock-overlay">
  <div class="ui-lock-panel">
    <i class="fas fa-circle-notch fa-spin"></i>
    <span class="ml-2" i18n>Veuillez patienter…</span>
  </div>
</div>
za
<fieldset [disabled]="uiLock">
  <div class="columns page-fill">
    <div class="column">
      <div class="card card--scroller">
        <header class="card-header" style="align-items:center">
          <p class="card-header-title" i18n>Administration des templates de mail</p>

          <!-- Onglets types -->
          <div class="card-header-icon">
            <div class="tabs is-toggle is-small">
              <ul>
                <li *ngFor="let t of types" [class.is-active]="typeActif===t">
                  <a (click)="activerType(t)">
                    <span>{{ t }}</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </header>

        <div class="card-content">
          <div class="content">
            <div class="columns is-variable is-4">
              <!-- Édition -->
              <div class="column is-full-tablet is-half-desktop">
                <article class="panel is-info">
                  <p class="panel-heading" i18n>Template</p>

                  <div class="panel-block">
                    <div class="field" style="width:100%">
                      <label class="label" i18n>Sujet</label>
                      <input class="input" [(ngModel)]="sujet" (input)="genererPreview()" />
                    </div>
                  </div>

<div class="panel-block">
  <div class="field" style="width:100%">
    <label class="label" i18n>Contenu HTML</label>

   <textarea
  class="textarea"
  rows="18"
  [(ngModel)]="html"
  (input)="detecterChamps(); genererPreview()"
  i18n-placeholder
  placeholder="Votre template HTML avec &#123; &#123;CHAMP&#125;&#125; et les boucles [[ ... ]].">
</textarea>

  <p class="help">
  <ng-container i18n>Utilisez</ng-container>
  <code>&#123; &#123;NOM&#125;&#125;</code>
  <ng-container i18n>pour un champ global, et entourez les lignes répétées avec</ng-container>
  <code>[[ ... ]]</code>
  <ng-container i18n>pour les boucles.</ng-container>
</p>
  </div>
</div>


                  <div class="panel-block">
                    <button class="button is-primary is-light"
                            (click)="sauvegarder()">
                      <i class="fa-solid fa-floppy-disk"></i>&nbsp;<span i18n>Sauvegarder</span>
                    </button>
                  </div>
                </article>
              </div>

              <!-- Paramètres / valeurs de test + Preview -->
              <div class="column is-full-tablet is-half-desktop">
                <article class="panel is-success">
                  <p class="panel-heading" i18n>Champs & Aperçu</p>

                  <!-- Champs globaux -->
                  <div class="panel-block" *ngIf="placeholdersGlobaux.length>0">
                    <div class="field" style="width:100%">
                      <label class="label" i18n>Valeurs globales</label>
                      <div class="columns is-multiline is-variable is-2">
                        <div class="column is-half" *ngFor="let k of placeholdersGlobaux">
                          <label class="label is-size-7">{{ k }}</label>
                          <input class="input input--dense"
                                 [(ngModel)]="formGlobaux[k]"
                                 (input)="genererPreview()"
                                 [placeholder]="k" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Boucle -->
                  <div class="panel-block" *ngIf="placeholdersLoop.length>0">
                    <div style="width:100%">
                      <label class="label" i18n>Boucle (répéter pour chaque élément)</label>

                      <div class="box is-light" *ngFor="let item of formLoopItems; let i = index">
                        <div class="is-flex is-justify-content-space-between is-align-items-center mb-2">
                          <strong i18n>Élément {{ i + 1 }}</strong>
                          <button class="delete" title="Supprimer" (click)="supprimerLigneLoop(i)"></button>
                        </div>

                        <div class="columns is-multiline is-variable is-2">
                          <div class="column is-half" *ngFor="let k of placeholdersLoop">
                            <label class="label is-size-7">{{ k }}</label>
                            <input class="input input--dense"
                                   [(ngModel)]="item[k]"
                                   (input)="genererPreview()"
                                   [placeholder]="k" />
                          </div>
                        </div>
                      </div>

                      <div class="buttons">
                        <button class="button is-outlined is-success is-small"
                                (click)="ajouterLigneLoop()">
                          <i class="fas fa-plus"></i>&nbsp;<span i18n>Ajouter un élément</span>
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Aperçu rendu (sujet + HTML) -->
                  <div class="panel-block">
                    <div style="width:100%">
                      <label class="label" i18n>Aperçu rendu</label>
                      <mail-template-preview [html]="previewHtml"></mail-template-preview>
                    </div>
                  </div>
                </article>
              </div>
            </div>

          </div>
        </div>

        <footer class="card-footer">
          <div class="card-footer-item">
            <span class="is-size-7 has-text-grey" i18n>
              Astuce : les champs à l’intérieur de <code>[[ ... ]]</code> seront répétés pour chaque ligne que tu ajoutes ci-dessus.
            </span>
          </div>
        </footer>
      </div>
    </div>
  </div>
</fieldset>
