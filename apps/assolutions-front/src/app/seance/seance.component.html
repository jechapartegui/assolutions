<div class="container">
  <ng-container *ngIf="loading">
    <progress
      class="progress is-large is-info"
      style="margin-top: 60px"
      max="100"
    >
      60%
    </progress>
    <p>Chargement en cours</p>
  </ng-container>
  <ng-container *ngIf="!loading">
    <ng-container *ngIf="!editSeance">
        <span class="fullscreen">
          <div class="columns page-fill">
            <div class="column">
              <div class="card card--scroller">
                <header class="card-header" style="align-items: center">
                  <p class="card-header-title"
                  *ngIf="
                    list_seance_VM
                      | multifiltersSeance : filters as filteredApplis
                  "
                >
                  <span i18n>Liste des séances</span>&nbsp;({{
                    filteredApplis.length
                  }})&nbsp;-&nbsp;<span i18n>Saison</span>&nbsp;{{
                    getActiveSaison()
                  }}
                </p>
              </header>
              <div class="card-content" #scrollableContent>
                <table
                  class="table"
                  style="width: 100%; font-size: smaller"
                  *ngIf="list_seance_VM && list_seance_VM.length > 0"
                >
                  <thead>
                    <tr>
                      <th>
                        <span>
                          <span class="ligne">
                            <span
                              [ngClass]="
                                filters.filter_nom ? 'has-text-info' : ''
                              "
                              i18n
                              >Nom</span
                            >
                            <span style="cursor: pointer">
                              <i
                                *ngIf="sort_nom === 'NO'"
                                (click)="Sort('ASC', 'nom')"
                                class="fa-solid fa-sort"
                              ></i>
                              <i
                                *ngIf="sort_nom === 'ASC'"
                                (click)="Sort('DESC', 'nom')"
                                class="fa-solid fa-sort-up"
                              ></i>
                              <i
                                *ngIf="sort_nom === 'DESC'"
                                (click)="Sort('ASC', 'nom')"
                                class="fa-solid fa-sort-down"
                              ></i>
                            </span>
                          </span>
                        </span>
                      </th>
                      <th>
                        <span>
                          <span class="ligne">
                            <span i18n>Cours / Type</span>
                            <span style="cursor: pointer">
                              <i
                                *ngIf="sort_cours === 'NO'"
                                (click)="Sort('ASC', 'type')"
                                class="fa-solid fa-sort"
                              ></i>
                              <i
                                *ngIf="sort_cours === 'ASC'"
                                (click)="Sort('DESC', 'type')"
                                class="fa-solid fa-sort-up"
                              ></i>
                              <i
                                *ngIf="sort_cours === 'DESC'"
                                (click)="Sort('ASC', 'type')"
                                class="fa-solid fa-sort-down"
                              ></i>
                            </span>
                          </span>
                        </span>
                      </th>
                      <th>
                        <span>
                          <span class="ligne">
                            <span
                              [ngClass]="
                                filters.filter_date_apres ||
                                filters.filter_date_avant
                                  ? 'has-text-info'
                                  : ''
                              "
                              i18n
                              >Date</span
                            >
                            <span style="cursor: pointer">
                              <i
                                *ngIf="sort_date === 'NO'"
                                (click)="Sort('ASC', 'date')"
                                class="fa-solid fa-sort"
                              ></i>
                              <i
                                *ngIf="sort_date === 'ASC'"
                                (click)="Sort('DESC', 'date')"
                                class="fa-solid fa-sort-up"
                              ></i>
                              <i
                                *ngIf="sort_date === 'DESC'"
                                (click)="Sort('ASC', 'date')"
                                class="fa-solid fa-sort-down"
                              ></i> </span
                          ></span>
                        </span>
                      </th>

                      <th>
                        <span>
                          <span class="ligne">
                            <span i18n>Heure / Durée</span>
                          </span>
                        </span>
                      </th>
                      <th>
                        <span>
                          <span class="ligne">
                            <span
                              [ngClass]="
                                filters.filter_prof ? 'has-text-info' : ''
                              "
                              i18n
                              >Professeurs</span
                            >
                          </span>
                        </span>
                      </th>

                      <th>
                        <span>
                          <span class="ligne">
                            <span
                              [ngClass]="
                                filters.filter_lieu ? 'has-text-info' : ''
                              "
                              i18n
                              >Lieu</span
                            >
                            <span style="cursor: pointer">
                              <i
                                *ngIf="sort_lieu === 'NO'"
                                (click)="Sort('ASC', 'lieu')"
                                class="fa-solid fa-sort"
                              ></i>
                              <i
                                *ngIf="sort_lieu === 'ASC'"
                                (click)="Sort('DESC', 'lieu')"
                                class="fa-solid fa-sort-up"
                              ></i>
                              <i
                                *ngIf="sort_lieu === 'DESC'"
                                (click)="Sort('ASC', 'lieu')"
                                class="fa-solid fa-sort-down"
                              ></i>
                            </span>
                          </span>
                        </span>
                      </th>
                      <th>
                        <span>
                          <span
                            [ngClass]="
                              filters.filter_groupe ? 'has-text-info' : ''
                            "
                            i18n
                            >Groupes</span
                          >
                        </span>
                      </th>
                      <th>
                        <span>
                          <span
                            [ngClass]="
                              filters.filter_statut ? 'has-text-info' : ''
                            "
                            i18n
                            >Statut</span
                          >
                        </span>
                      </th>
                      <th>
                        <span i18n>Action</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="
                        let seance of list_seance_VM
                          | multifiltersSeance : filters
                      "
                    >
                      <td>
                        {{ seance.libelle }}
                      </td>
                      <td>
                        <ng-container
                          *ngIf="seance.type_seance === 'ENTRAINEMENT'"
                        >
                          <ng-container *ngFor="let cours of listeCours">
                            <ng-container *ngIf="seance.cours == cours.id">
                              <span>{{ cours.nom }}</span>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                        <ng-container *ngIf="seance.type_seance === 'MATCH'">
                          <span i18n>Match</span>
                        </ng-container>
                        <ng-container
                          *ngIf="seance.type_seance === 'EVENEMENT'"
                        >
                          <span i18n>Evénement</span>
                        </ng-container>
                        <ng-container *ngIf="seance.type_seance === 'SORTIE'">
                          <span i18n>Sortie</span>
                        </ng-container>
                      </td>
                      <td>{{ seance.date_seance | date : 'dd/MM/yyyy' }}</td>
                      <td>
                        {{ seance.heure_debut }} ({{ seance.duree_seance }}
                        <span i18n>&nbsp;min</span>)
                      </td>
                      <td class="no_mobile">
                        <div class="tags is-small">
                          <ng-container
                            *ngFor="let gr of seance.seanceProfesseurs"
                          >
                            <span class="tag is-success">
                              {{ gr.personne.prenom }} {{ gr.personne.nom }}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                      <td>{{ trouverLieu(seance.lieu_id) }}</td>
                      <td class="no_mobile">
                        <div class="tags is-small">
                          <ng-container *ngFor="let gr of seance.groupes">
                            <span class="tag is-success">
                              {{ gr.nom }}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                      <td>
                        <ng-container *ngIf="seance.statut == 'prévue'">
                          <span class="tag is-info is-rounded is-light">
                            <span class="icon has-text-info">
                              <i class="fa-solid fa-calendar-check"></i>
                            </span>
                          </span>
                        </ng-container>
                        <ng-container *ngIf="seance.statut == 'réalisée'">
                          <span class="tag is-primary is-rounded is-light">
                            <span class="icon has-text-success">
                              <i class="fa-solid fa-flag-checkered"></i>
                            </span>
                          </span>
                        </ng-container>
                        <ng-container *ngIf="seance.statut == 'annulée'">
                          <span class="tag is-danger is-rounded is-light">
                            <span class="icon has-text-danger">
                              <i class="fa-solid fa-ban"></i>
                            </span>
                          </span>
                        </ng-container>
                      </td>
                      <td>
                        <div class="buttons" style="flex-wrap: nowrap">
                          <btn
                            i18n-title
                            title="Supprimer"
                            [type_button]="'SupprimerLight'"
                            (click)="Delete(seance)"
                          ></btn>
                          <btn
                            i18n-title
                            title="Voir"
                            [type_button]="'VoirLight'"
                            (click)="VoirMaSeanceByID(seance.seance_id)"
                          ></btn>
                          <btn
                            i18n-title
                            title="Editer"
                            [type_button]="'EditerLight'"
                            (click)="Edit(seance)"
                          ></btn>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <p *ngIf="!list_seance_VM || list_seance_VM.length == 0">
                  Pas de séances disponible
                </p>
                <button
                  class="scroll-to-top"
                  *ngIf="showScrollToTop"
                  (click)="scrollToTop()"
                  title="Revenir en haut"
                >
                  ↑
                </button>
              </div>
              <footer class="card-footer">
                <div class="columns">
                  <div class="column">
                    <div *ngIf="!afficher_filtre" class="buttons">
                      <btn [type_button]="'CreerSmall'" (click)="Creer()"></btn>
                      <btn
                        [type_button]="'FiltrerSmall'"
                        (click)="
                          afficher_filtre
                            ? (afficher_filtre = false)
                            : (afficher_filtre = true)
                        "
                      ></btn>
                      <btn
                        [type_button]="'CreerSerieSmall'"
                        (click)="Creer(true)"
                      ></btn>
                    

                      <btn
                        [type_button]="'TerminerSeancesSmall'"
                        (click)="TerminerSeances()"
                      ></btn>
                      <btn
                        [type_button]="'ExporterSmall'"
                        (click)="ExportExcel()"
                      ></btn>
                      <div class="field is-horizontal">
                        <div class="field-label is-normal is-two-quarter">
                          <label class="label" style="white-space: nowrap" i18n
                            >Saison affichée</label
                          >
                        </div>
                        <div class="field-body">
                          <div class="field is-narrow">
                            <div class="control">
                              <div class="select is-fullwidth">
                                <select
                                  [(ngModel)]="active_saison"
                                  (ngModelChange)="UpdateListeSeance()"
                                >
                                  <ng-container
                                    *ngFor="let saison of liste_saison"
                                  >
                                    <option [ngValue]="saison">
                                      {{ saison.nom }}
                                    </option>
                                  </ng-container>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="buttons" *ngIf="afficher_filtre">
                      <btn
                        (click)="
                          afficher_filtre = false; selected_filter = null
                        "
                        [type_button]="'RetourLight'"
                      ></btn>
                      <div
                        class="field is-horizontal"
                        style="gap: 0.5rem; align-items: center"
                      >
                        <div class="field-label is-normal">
                          <label class="label" style="white-space: nowrap" i18n
                            >Sélection du filtre</label
                          >
                        </div>
                        <div class="field-body">
                          <div class="field is-narrow">
                            <div class="control">
                              <div
                                class="select is-fullwidth ; font-size: smaller"
                              >
                                <select [(ngModel)]="selected_filter">
                                  <option value="nom" i18n>Nom</option>
                                  <option value="date" i18n>Date</option>
                                  <option value="groupe" i18n>Groupe</option>
                                  <option value="statut" i18n>Statut</option>
                                  <option value="prof" i18n>Professeur</option>
                                  <option value="lieu" i18n>Lieu</option>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div
                          *ngIf="selected_filter"
                          class="field-label is-normal"
                        >
                          <label class="label" style="white-space: nowrap" i18n
                            >Valeur du filtre
                          </label>
                        </div>
                        <div class="field-body" *ngIf="selected_filter">
                          <div class="field is-narrow">
                            <div class="control">
                              <input
                                *ngIf="selected_filter == 'nom'"
                                style="width: fit-content; font-size: smaller"
                                class="input is-small"
                                i18n-placeholder
                                placeholder="Nom du cours"
                                type="text"
                                [(ngModel)]="filters.filter_nom"
                              />
                              <div
                                class="select"
                                *ngIf="selected_filter == 'statut'"
                              >
                                <select
                                  style="font-size: smaller"
                                  [(ngModel)]="filters.filter_statut"
                                >
                                  <option [ngValue]="null" i18n>Tous</option>
                                  <option [ngValue]="'prévue'" i18n>
                                    Prévue
                                  </option>
                                  <option [ngValue]="'réalisée'" i18n>
                                    Réalisée
                                  </option>
                                  <option [ngValue]="'annulée'" i18n>
                                    Annulée
                                  </option>
                                </select>
                              </div>
                              <div
                                class="select"
                                *ngIf="selected_filter == 'groupe'"
                              >
                                <select
                                  style="font-size: smaller"
                                  [(ngModel)]="filters.filter_groupe"
                                >
                                  <option [ngValue]="null" i18n>Tous</option>
                                  <ng-container
                                    *ngFor="let group of liste_groupe_filter"
                                  >
                                    <option [ngValue]="group.value">
                                      {{ group.value }}
                                    </option>
                                  </ng-container>
                                </select>
                              </div>
                              <div
                                class="select"
                                *ngIf="selected_filter == 'prof'"
                              >
                                <select
                                  style="font-size: smaller"
                                  [(ngModel)]="filters.filter_prof"
                                >
                                  <option [ngValue]="null" i18n>Tous</option>
                                  <ng-container
                                    *ngFor="let prof of liste_prof_filter"
                                  >
                                    <option [ngValue]="prof.value">
                                      {{ prof.value }}
                                    </option>
                                  </ng-container>
                                </select>
                              </div>
                              <div
                                class="select"
                                *ngIf="selected_filter == 'lieu'"
                              >
                                <select
                                  style="font-size: smaller"
                                  [(ngModel)]="filters.filter_lieu"
                                >
                                  <option [ngValue]="null" i18n>Tous</option>
                                  <ng-container
                                    *ngFor="let lieu of liste_lieu_filter"
                                  >
                                    <option [ngValue]="lieu">
                                      {{ lieu }}
                                    </option>
                                  </ng-container>
                                </select>
                              </div>
                              <span
                                *ngIf="selected_filter == 'date'"
                                class="ligne"
                              >
                                <div
                                  style="gap: 6px"
                                  class="field is-small is-horizontal field-jecha"
                                >
                                  <label
                                    for="groupe"
                                    class="label is-small"
                                    i18n
                                    >Du</label
                                  >
                                  <input
                                    style="width: fit-content"
                                    class="input is-small"
                                    i18n-placeholder
                                    placeholder="Filtre date avant"
                                    type="date"
                                    [(ngModel)]="filters.filter_date_avant"
                                  />
                                </div>
                              </span>
                              <span
                                *ngIf="selected_filter == 'date'"
                                class="ligne"
                              >
                                <div
                                  style="gap: 6px"
                                  class="field is-small is-horizontal field-jecha"
                                >
                                  <label
                                    for="groupe"
                                    class="label is-small"
                                    i18n
                                    >Au</label
                                  >
                                  <input
                                    style="width: fit-content"
                                    class="input is-small"
                                    i18n-placeholder
                                    placeholder="Filtre date après"
                                    type="date"
                                    [(ngModel)]="filters.filter_date_apres"
                                  />
                                </div>
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="tags">
                          <span
                            *ngIf="filters.filter_nom"
                            class="tag is-success"
                          >
                            <span i18n>Nom : </span>
                            <span>{{ filters.filter_nom }}</span>
                            <button
                              class="delete"
                              (click)="filters.filter_nom = null"
                            ></button>
                          </span>

                          <span
                            *ngIf="filters.filter_statut != null"
                            class="tag is-success"
                          >
                            <span i18n>Statut : </span>
                            <span *ngIf="filters.filter_statut == 'prévue'" i18n
                              >Prévue</span
                            >
                            <span
                              *ngIf="filters.filter_statut == 'réalisée'"
                              i18n
                              >Réalisée</span
                            >
                            <span
                              *ngIf="filters.filter_statut == 'annulée'"
                              i18n
                              >Annulée</span
                            >
                            <button
                              class="delete"
                              (click)="filters.filter_statut = null"
                            ></button>
                          </span>

                          <span
                            *ngIf="
                              filters.filter_date_avant ||
                              filters.filter_date_apres
                            "
                            class="tag is-success"
                          >
                            <span i18n>Date : </span>
                            <span *ngIf="filters.filter_date_avant"
                              >&nbsp;>&nbsp;{{
                                filters.filter_date_avant | date : 'dd/MM/yyyy'
                              }}</span
                            >
                            <span *ngIf="filters.filter_date_apres"
                              >&nbsp;<&nbsp;{{
                                filters.filter_date_apres | date : 'dd/MM/yyyy'
                              }}</span
                            >
                            <button
                              class="delete"
                              (click)="
                                filters.filter_date_avant = null;
                                filters.filter_date_apres = null
                              "
                            ></button>
                          </span>

                          <span
                            *ngIf="filters.filter_lieu != null"
                            class="tag is-success"
                          >
                            <span i18n>Lieu : </span>
                            <span i18n>{{ filters.filter_lieu }}</span>

                            <button
                              class="delete"
                              (click)="filters.filter_lieu = null"
                            ></button>
                          </span>
                          <span
                            *ngIf="filters.filter_prof != null"
                            class="tag is-success"
                          >
                            <span i18n>Prof : </span>
                            <span i18n>{{ filters.filter_prof }}</span>

                            <button
                              class="delete"
                              (click)="filters.filter_prof = null"
                            ></button>
                          </span>
                          <span
                            *ngIf="filters.filter_groupe != null"
                            class="tag is-success"
                          >
                            <span i18n>Groupe : </span>
                            <span i18n>{{ filters.filter_groupe }}</span>
                            <button
                              class="delete"
                              (click)="filters.filter_groupe = null"
                            ></button>
                          </span>
                          <btn
                            [type_button]="'SupprimerLight'"
                            (click)="ReinitFiltre()"
                            *ngIf="
                              filters.filter_date_apres ||
                              filters.filter_date_avant ||
                              filters.filter_groupe ||
                              filters.filter_statut ||
                              filters.filter_nom ||
                              filters.filter_lieu ||
                              filters.filter_prof
                            "
                          >
                          </btn>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </footer>
            </div>
          </div>
        </div>
      </span>
      <span class="mobile">
        <ng-container *ngIf="afficher_filtre">
          <nav class="navbar is-fixed-top">
            <btn
              [type_button]="'RetourMobile'"
              (click)="afficher_filtre = false; selected_filter = null"
            ></btn>
          </nav>
          <span class="container-box">
            <div class="field" style="gap: 0.5rem; align-items: center">
              <div class="field-label is-normal">
                <label class="label" style="white-space: nowrap" i18n
                  >Sélection du filtre</label
                >
              </div>
              <div class="field-body">
                <div class="field is-narrow">
                  <div class="control">
                    <div class="select is-fullwidth ; font-size: smaller">
                      <select [(ngModel)]="selected_filter">
                        <option value="nom" i18n>Nom</option>
                        <option value="date" i18n>Date</option>
                        <option value="groupe" i18n>Groupe</option>
                        <option value="statut" i18n>Statut</option>
                        <option value="prof" i18n>Professeur</option>
                        <option value="lieu" i18n>Lieu</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngIf="selected_filter" class="field-label is-normal">
                <label class="label" style="white-space: nowrap" i18n
                  >Valeur du filtre
                </label>
              </div>
              <div class="field-body" *ngIf="selected_filter">
                <div class="field is-narrow">
                  <div class="control">
                    <input
                      *ngIf="selected_filter == 'nom'"
                      style="width: fit-content; font-size: smaller"
                      class="input is-small"
                      i18n-placeholder
                      placeholder="Nom du cours"
                      type="text"
                      [(ngModel)]="filters.filter_nom"
                    />
                    <div class="select" *ngIf="selected_filter == 'statut'">
                      <select
                        style="font-size: smaller"
                        [(ngModel)]="filters.filter_statut"
                      >
                        <option [ngValue]="null" i18n>Tous</option>
                        <option [ngValue]="'prévue'" i18n>Prévue</option>
                        <option [ngValue]="'réalisée'" i18n>Réalisée</option>
                        <option [ngValue]="'annulée'" i18n>Annulée</option>
                      </select>
                    </div>
                    <div class="select" *ngIf="selected_filter == 'groupe'">
                      <select
                        style="font-size: smaller"
                        [(ngModel)]="filters.filter_groupe"
                      >
                        <option [ngValue]="null" i18n>Tous</option>
                        <ng-container *ngFor="let group of liste_groupe_filter">
                          <option [ngValue]="group.value">
                            {{ group.value }}
                          </option>
                        </ng-container>
                      </select>
                    </div>
                    <div class="select" *ngIf="selected_filter == 'prof'">
                      <select
                        style="font-size: smaller"
                        [(ngModel)]="filters.filter_prof"
                      >
                        <option [ngValue]="null" i18n>Tous</option>
                        <ng-container *ngFor="let prof of liste_prof_filter">
                          <option [ngValue]="prof.value">
                            {{ prof.value }}
                          </option>
                        </ng-container>
                      </select>
                    </div>
                    <div class="select" *ngIf="selected_filter == 'lieu'">
                      <select
                        style="font-size: smaller"
                        [(ngModel)]="filters.filter_lieu"
                      >
                        <option [ngValue]="null" i18n>Tous</option>
                        <ng-container *ngFor="let lieu of liste_lieu_filter">
                          <option [ngValue]="lieu">
                            {{ lieu }}
                          </option>
                        </ng-container>
                      </select>
                    </div>
                    <span *ngIf="selected_filter == 'date'" class="ligne">
                      <div
                        style="gap: 6px"
                        class="field is-small is-horizontal field-jecha"
                      >
                        <label for="groupe" class="label is-small" i18n
                          >Du</label
                        >
                        <input
                          style="width: fit-content"
                          class="input is-small"
                          i18n-placeholder
                          placeholder="Filtre date avant"
                          type="date"
                          [(ngModel)]="filters.filter_date_avant"
                        />
                      </div>
                    </span>
                    <span *ngIf="selected_filter == 'date'" class="ligne">
                      <div
                        style="gap: 6px"
                        class="field is-small is-horizontal field-jecha"
                      >
                        <label for="groupe" class="label is-small" i18n
                          >Au</label
                        >
                        <input
                          style="width: fit-content"
                          class="input is-small"
                          i18n-placeholder
                          placeholder="Filtre date après"
                          type="date"
                          [(ngModel)]="filters.filter_date_apres"
                        />
                      </div>
                    </span>
                  </div>
                </div>
              </div>
              <div class="tags">
                <span
                  *ngIf="filters.filter_nom"
                  class="tag is-large is-success"
                >
                  <span i18n>Nom : </span>
                  <span>{{ filters.filter_nom }}</span>
                  <button
                    class="delete"
                    (click)="filters.filter_nom = null"
                  ></button>
                </span>

                <span
                  *ngIf="filters.filter_statut != null"
                  class="tag is-large is-success"
                >
                  <span i18n>Statut : </span>
                  <span *ngIf="filters.filter_statut == 'prévue'" i18n
                    >Prévue</span
                  >
                  <span *ngIf="filters.filter_statut == 'réalisée'" i18n
                    >Réalisée</span
                  >
                  <span *ngIf="filters.filter_statut == 'annulée'" i18n
                    >Annulée</span
                  >
                  <button
                    class="delete"
                    (click)="filters.filter_statut = null"
                  ></button>
                </span>

                <span
                  *ngIf="filters.filter_date_avant || filters.filter_date_apres"
                  class="tag is-large is-success"
                >
                  <span i18n>Date : </span>
                  <span *ngIf="filters.filter_date_avant"
                    >&nbsp;>&nbsp;{{
                      filters.filter_date_avant | date : 'dd/MM/yyyy'
                    }}</span
                  >
                  <span *ngIf="filters.filter_date_apres"
                    >&nbsp;<&nbsp;{{
                      filters.filter_date_apres | date : 'dd/MM/yyyy'
                    }}</span
                  >
                  <button
                    class="delete"
                    (click)="
                      filters.filter_date_avant = null;
                      filters.filter_date_apres = null
                    "
                  ></button>
                </span>

                <span
                  *ngIf="filters.filter_lieu != null"
                  class="tag is-large is-success"
                >
                  <span i18n>Lieu : </span>
                  <span i18n>{{ filters.filter_lieu }}</span>

                  <button
                    class="delete"
                    (click)="filters.filter_lieu = null"
                  ></button>
                </span>
                <span
                  *ngIf="filters.filter_prof != null"
                  class="tag is-large is-success"
                >
                  <span i18n>Prof : </span>
                  <span i18n>{{ filters.filter_prof }}</span>

                  <button
                    class="delete"
                    (click)="filters.filter_prof = null"
                  ></button>
                </span>
                <span
                  *ngIf="filters.filter_groupe != null"
                  class="tag is-large is-success"
                >
                  <span i18n>Groupe : </span>
                  <span i18n>{{ filters.filter_groupe }}</span>
                  <button
                    class="delete"
                    (click)="filters.filter_groupe = null"
                  ></button>
                </span>
                <btn
                  [type_button]="'SupprimerMobile'"
                  (click)="ReinitFiltre()"
                  *ngIf="
                    filters.filter_date_apres ||
                    filters.filter_date_avant ||
                    filters.filter_groupe ||
                    filters.filter_statut ||
                    filters.filter_nom ||
                    filters.filter_lieu ||
                    filters.filter_prof
                  "
                >
                </btn>
              </div>
            </div>
          </span>
        </ng-container>
        <ng-container *ngIf="afficher_tri">
          <nav class="navbar is-fixed-top">
            <btn
              [type_button]="'RetourMobile'"
              (click)="afficher_tri = false"
            ></btn>
          </nav>
          <span class="container-box">
            <div class="field">
              <div class="field-label is-normal">
                <label class="label" style="white-space: nowrap" i18n
                  >Sélection du tri</label
                >
              </div>
              <div class="field-body">
                <div class="field is-narrow">
                  <div class="control">
                    <div class="select is-fullwidth ; font-size: smaller">
                      <select [(ngModel)]="selected_sort">
                        <option value="nom" i18n>Nom</option>
                        <option value="date" i18n>Date</option>
                        <option value="cours" i18n>Cours / Evenement</option>
                        <option value="lieu" i18n>Lieu</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="field-label is-normal" *ngIf="selected_sort">
                <label class="label" style="white-space: nowrap" i18n
                  >Sens du tri
                </label>
              </div>
              <div class="field-body" *ngIf="selected_sort">
                <div class="field is-narrow">
                  <div class="control">
                    <div class="select is-fullwidth ; font-size: smaller">
                      <select
                        (ngModelChange)="Sort($event, selected_sort)"
                        [(ngModel)]="selected_sort_sens"
                      >
                        <option value="asc" i18n>Croissant</option>
                        <option value="desc" i18n>Décroissant</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </span>
        </ng-container>
        <ng-container *ngIf="!afficher_tri && !afficher_filtre">
          <nav class="navbar is-fixed-top">
            <btn
              [type_button]="'FiltrerMobile'"
              (click)="afficher_filtre = true"
            ></btn>
            <btn
              [type_button]="'TrierMobile'"
              (click)="afficher_tri = true"
            ></btn>
            <btn [type_button]="'CreerMobile'" (click)="Creer()"></btn>
          </nav>
            <div class="container-box">
          <ng-container
            *ngFor="let seance of list_seance_VM | multifiltersSeance : filters"
          >
              <article class="media">
                <div class="media-content">
                  <span class="title" (click)="Edit(seance)"
                    ><strong
                      >{{ seance.libelle }}&nbsp;{{
                        seance.date_seance | date : 'dd/MM/yyyy'
                      }} </strong
                    ></span
                  >
                  <div>
                    <ng-container *ngIf="seance.type_seance === 'ENTRAINEMENT'">
                      <span i18n>Cours</span>
                    </ng-container>
                    <ng-container *ngIf="seance.type_seance === 'MATCH'">
                      <span i18n>Match</span>
                    </ng-container>
                    <ng-container *ngIf="seance.type_seance === 'EVENEMENT'">
                      <span i18n>Evénement</span>
                    </ng-container>
                    <ng-container *ngIf="seance.type_seance === 'SORTIE'">
                      <span i18n>Sortie</span>
                    </ng-container>
                    - {{ seance.heure_debut }} ({{ seance.duree_seance }}
                    <span i18n>&nbsp;min</span>)
                    {{ trouverLieu(seance.lieu_id) }}
                    <ng-container *ngIf="seance.statut == 'prévue'">
                      <span class="tag is-info is-rounded is-light">
                        <span class="icon has-text-info">
                          <i class="fa-solid fa-calendar-check"></i>
                        </span>
                      </span>
                    </ng-container>
                    <ng-container *ngIf="seance.statut == 'réalisée'">
                      <span class="tag is-primary is-rounded is-light">
                        <span class="icon has-text-success">
                          <i class="fa-solid fa-flag-checkered"></i>
                        </span>
                      </span>
                    </ng-container>
                    <ng-container *ngIf="seance.statut == 'annulée'">
                      <span class="tag is-danger is-rounded is-light">
                        <span class="icon has-text-danger">
                          <i class="fa-solid fa-ban"></i>
                        </span>
                      </span>
                    </ng-container>
                  </div>
                </div>
              </article>
          </ng-container>
            </div>
        </ng-container>
      </span>
    </ng-container>

    <ng-container *ngIf="editSeance">
  <div class="columns page-fill">
            <div class="column">
              <div class="card card--scroller">
      <header class="card-header" style="align-items: center">
        <p class="card-header-title subtitle is-6"
                *ngIf="editSeance.seance_id == 0 && editMode_serie"
                i18n
              >
                Créer une série de séances
              </p>
              <p
                class="card-header-title"
                *ngIf="editSeance.seance_id == 0 && !editMode_serie"
                i18n
              >
                Créer une séance
              </p>
              <p
                class="card-header-title"
                *ngIf="editSeance.seance_id > 0"
                i18n
              >
                Editer une séance
              </p>
            </header>
            <div class="scrollable-card-content columns is-multiline is-variable is-3 p-3" >
              <!-- Bloc Infos personnelles -->
              <div class="column is-full-tablet is-half-desktop">
                <div class="box is-light">
                  <div class="is-flex is-justify-content-space-between is-align-items-center mb-3">
      <h3 class="subtitle is-6 has-text-primary has-text-weight-semibold" i18n>Informations essentielles
                  </h3>
                    <ng-container *ngIf="editSeance.seance_id > 0 && !readonly">
                      <btn
                        *ngIf="!edit_nom"
                        class="mx-1"
                        [type_button]="'EditerLight'"
                        (click)="edit_nom = true"
                      >
                      </btn>

                      <btn
                        *ngIf="edit_nom"
                        class="mx-1"
                        [type_button]="'SauvegarderLight'"
                        [disabled]="!rNom.key"
                        (click)="SaveNom()"
                      >
                      </btn>

                      <btn
                        *ngIf="edit_nom"
                        class="mx-1"
                        [type_button]="'AnnulerLight'"
                        (click)="(edit_nom = false) && retour() "
                      >
                      </btn>
                    </ng-container>
                  </div>

                <ng-container
                  *ngIf="editSeance.seance_id > 0; else NouvelleSeance"
                >
                  <ng-container *ngIf="edit_nom; else affichageNom">
                    <input
                      class="input"
                      [ngClass]="{ 'is-danger': !rNom.key }"
                      [(ngModel)]="editSeance.libelle"
                    />
                    <p *ngIf="!rNom.key" class="help is-danger is-small">
                      {{ rNom.value }}
                    </p>
                       <p ><strong i18n>Type de séance : </strong>{{ GetType(editSeance.type_seance)}}</p>
                      <p *ngIf="editSeance.cours"><strong i18n>Cours : </strong>{{ GetCours(editSeance.cours) }}</p>
                      <p ><strong i18n>Statut : </strong>
                        <ng-container  [ngSwitch]="editSeance.statut">
                            <span *ngSwitchCase="'prévue'" i18n>
                              Prévue
                            </span>
                            <span *ngSwitchCase="'réalisée'" i18n>
                              Réalisée
                            </span>
                            <span *ngSwitchCase="'annulée'" i18n>
                              Annulée
                            </span>
                        </ng-container>
                      </p>
                     <ng-container  [ngSwitch]="editSeance.statut">
                          <div *ngSwitchCase="'prévue'" class="buttons">
                          <btn [type_button]="'TerminerSeanceSmall'" (click)="editSeance.statut = 'réalisée'"></btn>
                            <btn [type_button]="'AnnulerSmall'" (click)="editSeance.statut = 'annulée'"></btn>
                        </div>
                        <span *ngSwitchCase="'réalisée'">
                          <btn [type_button]="'PlanifierSmall'" (click)="editSeance.statut = 'prévue'"></btn>
                            <btn [type_button]="'AnnulerSmall'" (click)="editSeance.statut = 'annulée'"></btn>

                          </span>
                        <span *ngSwitchCase="'annulée'">
                          <btn [type_button]="'PlanifierSmall'" (click)="editSeance.statut = 'prévue'"></btn>
                          <btn [type_button]="'TerminerSeanceSmall'" (click)="editSeance.statut = 'réalisée'"></btn>

                          </span>
                    </ng-container>
                  </ng-container>
                  <ng-template #affichageNom>
                      <p ><strong i18n>Libellé : </strong>{{ editSeance.libelle }}</p>
                      <p ><strong i18n>Type de séance : </strong>{{ GetType(editSeance.type_seance)}}</p>
                      <p *ngIf="editSeance.cours"><strong i18n>Cours : </strong>{{ GetCours(editSeance.cours) }}</p>
                      <p ><strong i18n>Statut : </strong>
                        <ng-container  [ngSwitch]="editSeance.statut">
                            <span *ngSwitchCase="'prévue'" i18n>
                              Prévue
                            </span>
                            <span *ngSwitchCase="'réalisée'" i18n>
                              Réalisée
                            </span>
                            <span *ngSwitchCase="'annulée'" i18n>
                              Annulée
                            </span>
                        </ng-container>
                      </p>
                   
                  </ng-template>
                </ng-container>
                <ng-template #NouvelleSeance>
                  <div class="field">
                    <label class="label" i18n>Libellé de séance</label>
                    <div class="control">
                      <input
                        class="input"
                        [ngClass]="{ 'is-danger': !rNom.key }"
                        [(ngModel)]="editSeance.libelle"
                        (ngModelChange)="checkall()"
                      />
                    </div>
                     <p *ngIf="!rNom.key" class="help is-danger is-small">
                      {{ rNom.value }}
                    </p>
                  </div>
                  <div class="field">
                    <label class="label" i18n>Type de séance</label>
                    <div class="select">
                      <select id="cours" [(ngModel)]="editSeance.type_seance">
                        <option value="ENTRAINEMENT" i18n>Cours</option>
                        <option value="SORTIE" i18n>Sortie</option>
                        <option value="EVENEMENT" i18n>Evenement</option>
                        <option value="MATCH" i18n>Match</option>
                      </select>
                    </div>
                    <p
                      class="help is-danger"
                      *ngIf="!editSeance.type_seance"
                      i18n
                    >
                      La sélection d'un type de séance est obligatoire
                    </p>
                  </div>
                  <div
                    *ngIf="editSeance.type_seance == 'ENTRAINEMENT'"
                    class="field"
                  >
                    <label class="label" i18n>Cours</label>
                    <div class="select">
                      <select
                        id="cours"
                        (ngModelChange)="onCoursSelectionChange($event)"
                        [(ngModel)]="editSeance.cours"
                      >
                        <option
                          *ngFor="let cours of listeCours"
                          [value]="cours.id"
                        >
                          {{ cours.nom }}
                        </option>
                      </select>
                    </div>
                    <p class="help is-danger" *ngIf="!editSeance.cours" i18n>
                      La sélection d'un cours est obligatoire
                    </p>
                  </div>
                </ng-template>
              </div>
              </div>
              <div class="column is-full-tablet is-half-desktop">
                <ng-container *ngIf="editMode_serie; else unique">
 <datelieu
                  [creneau]="true"
                  [duree]="editSeance.duree_seance"
                  [heure]="editSeance.heure_debut"
                  [jour_semaine]="jour_semaine"
                  [serie]="editMode_serie"
                  [date_debut]="date_debut_serie"
                  [date_fin]="date_fin_serie"
                  [rdv]="editSeance.rdv"
                  [ID]="editSeance.seance_id"
                  [lieu_id]="editSeance.lieu_id"
                  [Regles]="GlobalService.getRegles().SeanceSerie_DateLieu"
                  (datelieuChange)="SaveDateLieu($event)"
                  (valid)="valid_DateLieu($event)"
                ></datelieu>
                </ng-container>
                <ng-template #unique>
 <datelieu
                  [creneau]="false"
                  [duree]="editSeance.duree_seance"
                  [heure]="editSeance.heure_debut"
                  [jour_semaine]="jour_semaine"
                  [serie]="editMode_serie"
                  [date]="editSeance.date_seance"
                  [rdv]="editSeance.rdv"
                  [ID]="editSeance.seance_id"
                  [readonly]="readonly"
                  [lieu_id]="editSeance.lieu_id"
                  [Regles]="GlobalService.getRegles().Seance_DateLieu"
                  (datelieuChange)="SaveDateLieu($event)"
                  (valid)="valid_DateLieu($event)"
                ></datelieu>
                </ng-template>
               
              </div>
              <div class="column is-full-tablet is-half-desktop">
                <caracteristique-seance
                  [place_limite]="editSeance.est_place_maximum"
                  [place_limite_valeur]="editSeance.place_maximum"
                  [age_max]="editSeance.est_limite_age_maximum"
                  [age_min]="editSeance.est_limite_age_minimum"
                  [age_max_valeur]="editSeance.age_maximum"
                  [age_min_valeur]="editSeance.age_minimum"
                  [afficher_present]="editSeance.afficher_present"
                  [essai_possible]="editSeance.essai_possible"
                  [ID]="editSeance.seance_id"
                  [readonly]="readonly"
                  [Regles]="GlobalService.getRegles().Seance_Parametres"
                  (valueChange)="SaveCaracteristique($event)"
                  (valid)="valid_Caracteristique($event)"
                ></caracteristique-seance>
              </div>
              <div class="column is-full-tablet is-half-desktop">
                <div class="box is-light">
                  <div
                    class="is-flex is-justify-content-space-between is-align-items-center mb-3"
                  >
                    <h3
                      class="subtitle is-6 has-text-primary has-text-weight-semibold"
                      i18n
                    >
                      Sélection des encadrants
                    </h3>
                    <ng-container *ngIf="editSeance.seance_id > 0 && !readonly">
                      <btn
                        *ngIf="!edit_prof"
                        [type_button]="'EditerLight'"
                        (click)="(edit_prof = true) && checkall()"
                      ></btn>
                      <btn
                        *ngIf="edit_prof"
                        [disabled]="!rProf.key"
                        (click)="autoSave()"
                        [type_button]="'SauvegarderLight'"
                      >
                      </btn>
                      <btn
                        *ngIf="edit_prof"
                        (click)="edit_prof = !edit_prof"
                        [type_button]="'AnnulerLight'"
                      >
                      </btn>
                    </ng-container>
                  </div>

                  <ng-container *ngIf="editSeance.seanceProfesseurs.length > 0">
                    <div class="tags">
                      <ng-container
                        *ngFor="let l of editSeance.seanceProfesseurs"
                      >
                        <span class="tag is-success">
                          {{
                            l.personne.prenom +
                              '\u00A0' +
                              (l.personne.nom || '')
                          }}
                          <button
                            *ngIf="edit_prof"
                            class="delete is-small"
                            (click)="RemoveProf(l)"
                          ></button>
                        </span>
                      </ng-container>
                    </div>
                  </ng-container>

                  <ng-container
                    *ngIf="editSeance.seanceProfesseurs?.length === 0"
                  >
                    <span i18n>Aucun encadrant sélectionné</span>
                    <p *ngIf="!rProf.key" class="is-small help is-danger">{{rProf.value}}</p>
                  </ng-container>
                  <ng-container *ngIf="edit_prof">
                    <h6 class="title is-6" i18n>Encadrants disponibles</h6>
                    <ng-container *ngIf="prof_dispo.length > 0">
                      <div class="select">
                        <select
                          style="font-size: smaller"
                          id="professeurs"
                          [(ngModel)]="current_prof_id"
                        >
                          <ng-container
                            *ngFor="let ni of prof_dispo; let first = first"
                          >
                            <option [value]="ni.person.id">
                              {{
                                (ni.person.prenom || '') +
                                  '\u00A0' +
                                  (ni.person.nom || '')
                              }}
                            </option>
                          </ng-container>
                        </select>
                      </div>
                      <button
                        type="button"
                        [disabled]="!current_prof_id"
                        (click)="AjouterProf()"
                        class="button is-primary is-small is-rounded is-outlined"
                        style="align-self: center; fill: hsl(171, 100%, 41%)"
                      >
                        <svg width="20" height="20">
                          <use xlink:href=".\assets\liste.svg#plus"></use>
                        </svg>
                      </button>
                    </ng-container>
                    <ng-container *ngIf="listeprof.length == 0">
                      <span i18n>Aucun encadrant disponible</span>
                    </ng-container>
                  </ng-container>
                </div>
              </div>

              <!-- Bloc Adresse -->
              <div  *ngIf="store.isLoggedIn && store.hasProjet && store.isProf" class="column is-full-tablet is-half-desktop">
                <app-groupe-detail
                  (groupesUpdated)="onGroupesUpdated($event)"
                  [id_source]="editSeance.seance_id"
                  [objet_source]="'cours'"
                  [edit]="!readonly"
                  [title]="titre_groupe"
                  [Groupes]="editSeance.groupes"
                  [liste_groupe]="liste_groupe"
                ></app-groupe-detail>
              </div>
            </div>

            <div class="card-footer">
              <div class="columns is-mobile is-centered">
                <div class="column is-half">
                  <div class="buttons" style="flex-wrap: nowrap">
                    <btn [type_button]="'RetourSmall'" (click)="RetourListe()"></btn>
                    <btn
                      *ngIf="editSeance.seance_id < 1"
                      [disabled]="!is_valid"
                      [type_button]="'SauvegarderSmall'"
                      (click)="Save()"
                    ></btn>
                    <ng-container *ngIf="editSeance.seance_id >0 && editSeance.afficher_present; else prof">
  <btn [type_button]="'VoirSmall'"
                      (click)="VoirMaSeance()"
                    ></btn>
                    </ng-container>
                    <ng-template #prof>                      
                     <btn
                     *ngIf="editSeance.seance_id >0 && store.isLoggedIn && store.hasProjet && store.isProf"
                    [type_button]="'VoirSmall'"
                      (click)="VoirMaSeance()"
                    ></btn> 
<div class="dropdown is-right" [class.is-up]="isDesktopDropUp" [class.is-active]="pollOpen">
  <div class="dropdown-trigger">
    <button
      class="button is-success is-outlined btn-mobile btn-elevated btn-compact"
      (click)="pollOpen = !pollOpen"
      title="Sondage WhatsApp">
      <span class="icon"><i class="fab fa-whatsapp"></i></span>
      <span>Sondage</span>
      <span class="icon is-small"><i class="fas fa-angle-down"></i></span>
    </button>
  </div>
  <div class="dropdown-menu" role="menu">
    <div class="dropdown-content">
      <a class="dropdown-item" (click)="generatePoll('avec'); pollOpen=false">
        <i class="fas fa-link"></i>&nbsp;Avec réponses (Oui / Non)
      </a>
      <a class="dropdown-item" (click)="generatePoll('seul'); pollOpen=false">
        <i class="fas fa-align-left"></i>&nbsp;Sondage seul
      </a>
    </div>
  </div>
</div>
<span *ngIf="pollCopied" class="tag is-success is-light ms-copy-hint">Copié !</span>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-container>
</div>
