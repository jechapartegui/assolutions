  <div class="columns page-fill">
            <div class="column">
              <div class="card card--scroller">
                <header class="card-header" style="align-items: center">
        <p class="card-header-title">
          <ng-container [ngSwitch]="etape">
            <span *ngSwitchCase="'SELECTION_MAIL'" i18n>Sélection du type de mail</span>
            <span *ngSwitchCase="'PARAMETRE'" i18n>Paramétrage du mail</span>
            <span *ngSwitchCase="'AUDIENCE'" i18n>Paramétrage des destinataires</span>
            <span *ngSwitchCase="'BROUILLON'" i18n>Revue du brouillon du mail</span>
          </ng-container>
        </p>
        <!-- (facultatif) un compact chevron pour plier/déplier quand tu veux garder l'habitus -->
       <nav class="card-header-icon breadcrumb is-small is-right" aria-label="breadcrumbs">
  <ul>
    <li [class.is-active]="etape==='SELECTION_MAIL'">
      <a (click)="goto('SELECTION_MAIL')">
        <span class="icon is-small"><i class="fas fa-list-ul"></i></span>&nbsp;<span>Sélection</span>
      </a>
    </li>

    <li [class.is-active]="etape==='PARAMETRE'" [class.is-disabled]="!canGoTo('PARAMETRE')">
      <a (click)="canGoTo('PARAMETRE') && goto('PARAMETRE')">
        <span class="icon is-small"><i class="fas fa-sliders-h"></i></span>&nbsp;<span>Paramètres</span>
      </a>
    </li>

    <li [class.is-active]="etape==='AUDIENCE'" [class.is-disabled]="!canGoTo('AUDIENCE')">
      <a (click)="canGoTo('AUDIENCE') && goto('AUDIENCE')">
        <span class="icon is-small"><i class="fas fa-users"></i></span>&nbsp;<span>Audience</span>
      </a>
    </li>

    <li [class.is-active]="etape==='BROUILLON'" [class.is-disabled]="!canGoTo('BROUILLON')">
      <a (click)="canGoTo('BROUILLON') && goto('BROUILLON')">
        <span class="icon is-small"><i class="fas fa-envelope-open-text"></i></span>&nbsp;<span>Brouillon</span>
      </a>
    </li>
  </ul>
</nav>

      </header>

      <!-- CONTENU SCROLLABLE -->
    <div class="card-content" #scrollableContent>
                  <div class="content">

        <!-- ÉTAPE 1 — Sélection du type -->
        <ng-container *ngIf="vue('SELECTION_MAIL')">
          <div *ngIf="ouvert_type_mail" class="content">
            <div class="buttons">
              <button type="button" (click)="GoToParam('relance')"
                      class="button is-primary is-small is-light btn-mobile btn-elevated">
                <i class="fas fa-calendar-alt"></i>&nbsp;<span i18n>Séances disponibles</span>
              </button>

              <button type="button" (click)="GoToParam('annulation')"
                      class="button is-primary is-small is-light btn-mobile btn-elevated">
                <i class="fas fa-ban"></i>&nbsp;<span i18n>Annulation séance</span>
              </button>

              <button type="button" (click)="GoToParam('convocation')"
                      class="button is-primary is-small is-light btn-mobile btn-elevated">
                <i class="fas fa-bullhorn"></i>&nbsp;<span i18n>Convocation à un événement</span>
              </button>

              <button type="button" (click)="Libre()"
                      class="button is-primary is-small is-light btn-mobile btn-elevated">
                <i class="fas fa-pen"></i>&nbsp;<span i18n>Message libre</span>
              </button>
            </div>
          </div>
        </ng-container>

        <!-- ÉTAPE 2 — Paramétrage -->
        <ng-container *ngIf="vue('PARAMETRE')">
          <div *ngIf="ouvert_param" class="content">
            <ng-container *ngIf="typemail !== 'libre'">
              <div class="columns is-multiline is-variable is-3">
                <div class="column is-full-tablet is-half-desktop">
                  <div class="field">
                    <label class="label" i18n>Date minimum de la séance</label>
                    <input class="input" id="date_seance_min" type="date" [(ngModel)]="date_debut" />
                    <p class="help is-danger" *ngIf="!date_debut" i18n>
                      La date de début de plage doit être saisie.
                    </p>
                  </div>
                </div>
                <div class="column is-full-tablet is-half-desktop">
                  <div class="field">
                    <label class="label" i18n>Date maximum de la séance</label>
                    <input class="input" id="date_seance_max" type="date" [(ngModel)]="date_fin" />
                    <p class="help is-danger" *ngIf="!date_fin" i18n>
                      La date de fin de plage doit être saisie.
                    </p>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="(typemail === 'annulation' || typemail === 'convocation') && seance_periode && seance_periode.length>0">
              <div class="field">
                <label class="label"><span *ngIf="typemail === 'annulation'" i18n>Séance annulée</span>
                <span *ngIf="typemail === 'convocation'" i18n>Convocation séance</span></label> 
                <div class="select is-fullwidth">
                  <select id="seance_annulee" style="font-size: smaller" [(ngModel)]="seance_annul_convoc">
                    <ng-container *ngFor="let pr of seance_periode">
                      <option [ngValue]="pr">{{ pr.libelle }}&nbsp; {{ pr.date_seance | date : 'dd/MM/yyyy' }} </option>
                    </ng-container>
                  </select>
                </div>
                <p class="help is-danger" *ngIf="!seance_annul_convoc" i18n>
                 Une séance doit être sélectionnée.	
                </p>
              </div>

              </ng-container>
              </div>
        </ng-container>

        <!-- ÉTAPE 3 — Audience -->
        <ng-container *ngIf="vue('AUDIENCE')">
          <div *ngIf="ouvert_audience" class="content">

            <div class="tabs is-toggle">
              <ul>
                <li (click)="audience = 'TOUS'" [class.is-active]="audience==='TOUS'">
                  <a><span i18n>Tous les adhérents</span></a>
                </li>
                <li (click)="audience = 'GROUPE'" [class.is-active]="audience==='GROUPE'">
                  <a><span i18n>Groupes</span></a>
                </li>
                <li (click)="audience = 'SEANCE'" [class.is-active]="audience==='SEANCE'">
                  <a><span i18n>Participants à une séance</span></a>
                </li>
                <li (click)="audience = 'ADHERENT'" [class.is-active]="audience==='ADHERENT'">
                  <a><span i18n>Par adhérent</span></a>
                </li>
              </ul>
            </div>

            <!-- TOUS -->
            <div *ngIf="audience==='TOUS'" class="block">
              <button (click)="AddUsers(true)" type="button"
                      class="button is-primary is-small is-light btn-mobile btn-elevated">
                <i class="fas fa-user-friends"></i>&nbsp;<span i18n>Ajouter les adhérents inscrits cette saison</span>
              </button>
              <button (click)="AddUsers()" type="button"
                      class="button is-primary is-small is-light btn-mobile btn-elevated">
                <i class="fas fa-user-friends"></i>&nbsp;<span i18n>Ajouter tous les adhérents</span>
              </button>
            </div>

            <!-- GROUPE -->
            <div *ngIf="audience==='GROUPE'" class="block">
              <div class="field">
                <label for="groupe" class="label" i18n>Groupes</label>
                <div class="select is-fullwidth">
                  <select id="groupe" style="font-size: smaller" [(ngModel)]="groupe_selectionne">
                    <ng-container *ngFor="let pr of liste_groupe">
                      <option [value]="pr.id">{{ pr.nom }}</option>
                    </ng-container>
                  </select>
                </div>
              </div>
              <div class="field">
                <button [disabled]="!groupe_selectionne" (click)="AddGroupe()" type="button"
                        class="button is-outlined is-success btn-mobile btn-elevated">
                  <i class="fas fa-plus"></i>&nbsp;<span i18n>Ajouter les personnes du groupe</span>
                </button>
              </div>
            </div>

            <!-- SEANCE -->
            <div *ngIf="audience==='SEANCE'" class="block">
              <div class="field">
                <label for="seance" class="label" i18n>Séance</label>
                <div class="select is-fullwidth">
                  <select id="seance" style="font-size: smaller" [(ngModel)]="seance_selectionnee">
                    <ng-container *ngFor="let pr of seance_periode">
                      <option [ngValue]="pr">{{ pr.libelle }}&nbsp; {{ pr.date_seance | date : 'dd/MM/yyyy' }} </option>
                    </ng-container>
                  </select>
                </div>
              </div>
              <div class="field buttons">
                <button [disabled]="!seance_selectionnee" (click)="AddSeanceTous()" type="button"
                        class="button is-primary is-small is-light btn-mobile btn-elevated">
                  <i class="fas fa-user-plus"></i>&nbsp;<span i18n>Ajouter toutes les personnes de la séance</span>
                </button>
                <button [disabled]="!seance_selectionnee" (click)="AddSeancePresent()" type="button"
                        class="button is-primary is-small is-light btn-mobile btn-elevated">
                  <i class="fas fa-user-check"></i>&nbsp;<span i18n>Seulement ceux déclarés présents</span>
                </button>
                <button [disabled]="!seance_selectionnee" (click)="AddSeanceConvoque()" type="button"
                        class="button is-primary is-small is-light btn-mobile btn-elevated">
                  <i class="fas fa-bullhorn"></i>&nbsp;<span i18n>Seulement les convoqués</span>
                </button>
              </div>
            </div>

            <!-- ADHERENT -->
            <div *ngIf="audience==='ADHERENT'" class="block">
              <div class="field">
                <label for="adh" class="label" i18n>Adhérents</label>
                <div class="select is-fullwidth">
                  <select id="adh" style="font-size: smaller" [(ngModel)]="adherent_selectionne">
                    <ng-container *ngFor="let pr of liste_adherent">
                      <option [ngValue]="pr">{{ pr.libelle }}&nbsp;{{ calculateAge(pr.date_naissance) }} <span i18n>ans</span></option>
                    </ng-container>
                  </select>
                </div>
              </div>
              <div class="field">
                <button [disabled]="!adherent_selectionne" (click)="Addherent()" type="button"
                        class="button is-primary is-small is-light btn-mobile btn-elevated">
                  <i class="fas fa-plus"></i>&nbsp;<span i18n>Ajouter</span>
                </button>
              </div>
            </div>

            <!-- Tags sélection -->
            <div class="block">
              <div class="tags are-large">
                <ng-container *ngFor="let user of ListeUserSelectionne">
                  <span class="tag is-warning is-medium">
                    {{ user.libelle }}
                    <button (click)="RemoveUser(user)" class="delete is-small"></button>
                  </span>
                </ng-container>
              </div>
            </div>

          </div>
        </ng-container>

        <!-- ÉTAPE 4 — Brouillon -->
        <ng-container *ngIf="vue('BROUILLON')">
          <div *ngIf="ouvert_brouillon" class="content">
            <div class="columns is-variable is-4">
              <div class="column is-full-tablet is-half-desktop">
                <article class="panel is-success" *ngIf="mail_a_generer">
                  <p class="panel-heading" i18n>Vue HTML</p>
                  <div class="panel-block">
                    <div class="field" style="width:100%">
                      <label class="label" i18n>Sujet :</label>
                      <input type="text" class="input" [(ngModel)]="subject_mail_a_generer" />
                    </div>
                  </div>
                  <div class="panel-block">
                    <textarea class="textarea" rows="18" style="font-size: smaller"
                              i18n-placeholder placeholder="Ici s'affichera le contenu du mail en HTML"
                              [(ngModel)]="mail_a_generer"></textarea>
                  </div>
                </article>

                <div class="buttons" *ngIf="mail_a_generer">
             <label class="checkbox">
  <input type="checkbox" *ngIf="typemail==='libre'" [(ngModel)]="envoi_par_compte"/>
  <span i18n>Envoyer par compte</span>
</label>
                
                </div>
              </div>

              <div *ngIf="ListeGeneree && ListeGeneree.length>0" class="column is-full-tablet is-half-desktop">
                <article class="panel is-success" >
                  <p class="panel-heading" i18n>Vue Générée</p>
    <div class="select is-fullwidth">
  <select id="adh" style="font-size: smaller" [(ngModel)]="adherent_generer_vue">
    <!-- met directement *ngFor sur option -->
   <option *ngFor="let pr of ListeGeneree;"
          [ngValue]="pr"
          [innerText]="makeLabel(pr.key)">
  </select>
</div>

<ng-container *ngIf="adherent_generer_vue">
  <label class="label">Sujet</label>
  <mail-template-preview [html]="adherent_generer_vue.value.key"></mail-template-preview>

  <label class="label mt-2">Message</label>
  <mail-template-preview [html]="adherent_generer_vue.value.value"></mail-template-preview>
</ng-container>


                </article>

                
              </div>
            </div>
          </div>
        </ng-container>

      </div>

<footer class="card-footer" [ngSwitch]="etape">
  <div class="card-footer-item" style="width:100%">
    <div class="columns is-mobile is-multiline" style="width:100%">
      <div class="column is-full">
        <div class="buttons">

          <!-- ÉTAPE 1 — SELECTION_MAIL : (optionnel) rien à mettre si tout se passe via les cartes/boutons de sélection -->

          <!-- ÉTAPE 2 — PARAMETRE -->
          <ng-container *ngSwitchCase="'PARAMETRE'">
            <ng-container *ngIf="typemail !== 'libre'">
            <button type="button"
                    (click)="ValiderPlage()"
                    [disabled]="!date_debut || !date_fin"
                    class="button is-primary is-small is-light btn-mobile btn-elevated">
              <i class="fas fa-check"></i>&nbsp;<span i18n>Valider la plage</span>
            </button>
            </ng-container>
            <ng-container *ngIf="(typemail === 'annulation' || typemail === 'convocation') && seance_periode && seance_periode.length>0">
 <button type="button"
                    (click)="ValiderSeance()"
                    [disabled]="seance_annul_convoc==null"
                    class="button is-primary is-small is-light btn-mobile btn-elevated">
              <i class="fas fa-check"></i>&nbsp;<span i18n>Valider la séance</span>
            </button>
              </ng-container>
          </ng-container>

          <!-- ÉTAPE 3 — AUDIENCE -->
          <ng-container *ngSwitchCase="'AUDIENCE'">
            <button type="button"
                    (click)="ValiderDestinataire()"
                    [disabled]="ListeUserSelectionne.length === 0"
                    class="button is-primary is-small is-light btn-mobile btn-elevated">
              <i class="fas fa-check"></i>&nbsp;<span i18n>Valider la liste de destinataire</span>
            </button>

            <button type="button"
                    (click)="RemoveUsers()"
                    [disabled]="ListeUserSelectionne.length === 0"
                    class="button is-dangeris-small is-light btn-mobile btn-elevated">
              <i class="fas fa-trash"></i>&nbsp;<span i18n>Vider la liste</span>
            </button>
          </ng-container>

          <!-- ÉTAPE 4 — BROUILLON -->
          <ng-container *ngSwitchCase="'BROUILLON'">
            <button type="button"
                    (click)="GenererVue()"
                    [disabled]="!mail_a_generer"
                    class="button is-info is-small is-light btn-mobile btn-elevated">
              <span i18n>Générer la vue avec ce mail</span>&nbsp;<i class="fa-solid fa-rotate-right"></i>
            </button>

            <button type="button"
                    (click)="SauvegarderTemplate()"
                    [disabled]="!mail_a_generer || !subject_mail_a_generer"
                    class="button is-primary is-small is-light btn-mobile btn-elevated">
              <span i18n>Sauvegarder le template</span>&nbsp;<i class="fa-solid fa-floppy-disk"></i>
            </button>

            <button type="button"
                    (click)="EnvoyerTousLesMails()"
                    [disabled]="!(ListeGeneree && ListeGeneree.length>0)"
                    class="button is-primary is-small is-light btn-mobile btn-elevated">
              <span i18n>Envoyer tous les mails</span>&nbsp;<i class="far fa-paper-plane"></i>
            </button>

            <button type="button"
                    (click)="EnvoiMail()"
                    [disabled]="!adherent_generer_vue"
                    class="button is-primary is-small is-light btn-mobile btn-elevated">
              <span i18n>Envoyer cet email</span>&nbsp;<i class="far fa-paper-plane"></i>
            </button>
          </ng-container>

        </div>
      </div>
    </div>
  </div>
</footer>


    </div>
  </div>
</div>
