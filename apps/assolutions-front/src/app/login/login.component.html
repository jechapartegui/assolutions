<div class="login-wrapper">
  <ng-container *ngIf="loading">
    <div class="login-loading">
      <progress class="progress is-small is-info" max="100">60%</progress>
      <p class="has-text-grey" i18n>Chargement en cours…</p>
    </div>
  </ng-container>
<<<<<<< HEAD

  <ng-container *ngIf="!loading">
    <div class="columns is-centered">
      <div
        class="column is-11-mobile is-8-tablet is-5-desktop is-4-widescreen"
      >
        <div class="box login-card">
          <!-- HEADER -->
          <header class="login-header has-text-centered">
            <div class="login-logo">
              <span class="icon is-medium">
                <i class="fas fa-user-circle"></i>
=======
  <ng-container *ngIf="!loading">
    <div class="columns is-justify-content-center">
      <div class="column is-6-tablet is-5-desktop is-4-widescreen is-3-fullh">
        <div class="box">
          <h3 class="title is-3" i18n>Connexion</h3>
          <h6 class="subtitle is-6">{{libelle_titre}}</h6>
          <div class="field">
            <p *ngIf="!selectedLogin" class="control has-icons-left has-icons-right">
             <input
  [class]="VM.isLoginValid ? 'input' : 'input is-danger'"
  name="username"
  autocomplete="username email"
  (ngModelChange)="validateLogin()"
  (keypress)="onKeyPress($event)"
  (input)="validateLogin()"
  [(ngModel)]="VM.Login"
  type="email"
  placeholder="Email"
/>

              <span class="icon is-small is-left">
                <i class="fas fa-envelope"></i>
              </span>
              <span *ngIf="VM.isLoginValid" class="icon is-small is-right">
                <i class="fas fa-check"></i>
              </span>
            </p>
            <p *ngIf="selectedLogin">{{VM.Login}} <btn [type_button]="'AnnulerSmallLight'" (click)="selectedLogin=false; VM.mdp_requis=false"></btn></p>
          </div>
          <div *ngIf="VM.mdp_requis" class="field">
          <h6 *ngIf="context == 'CREATE' && !VM.creer_compte" class="subtitle is-6" i18n>Ce compte est protégé par un mot de passe, merci de saisir le mot de passe projet pour créer un adhérent sur ce compte.</h6>
            <p class="control has-icons-left has-icons-right">
            <input
  *ngIf="VM.mdp_requis"
  [class]="VM.isPasswordValid ? 'input' : 'input is-danger'"
  name="password"
  autocomplete="current-password"
  (ngModelChange)="validatePassword($event)"
  [(ngModel)]="VM.Password"
  (keypress)="onKeyPressMdp($event)"
  type="password"
  placeholder="Password"
/>
              <span class="icon is-small is-left">
                <i class="fas fa-lock"></i>
              </span>
              <span *ngIf="VM.isPasswordValid" class="icon is-small is-right">
                <i class="fas fa-check"></i>
>>>>>>> 4dfa31a7fcc4eb1ca2be9bc43f1b33985bdd1478
              </span>
            </div>
            <h1 class="title is-4 mb-1" i18n>Connexion</h1>
            <p class="subtitle is-6 has-text-grey">
              {{ libelle_titre }}
            </p>
          </header>

          <!-- CORPS DU FORMULAIRE -->
          <section class="login-body">
            <!-- Email -->
            <div class="field">
              <label class="label is-small" for="loginEmail" i18n>Email</label>

              <p
                *ngIf="!selectedLogin"
                class="control has-icons-left has-icons-right"
              >
                <input
                  id="loginEmail"
                  [class]="VM.isLoginValid ? 'input' : 'input is-danger'"
                  type="email"
                  placeholder="vous@exemple.fr"
                  i18n-placeholder
                  [(ngModel)]="VM.Login"
                  (ngModelChange)="validateLogin()"
                  (input)="validateLogin()"
                  (keypress)="onKeyPress($event)"
                />
                <span class="icon is-small is-left">
                  <i class="fas fa-envelope"></i>
                </span>
                <span
                  *ngIf="VM.isLoginValid"
                  class="icon is-small is-right has-text-success"
                >
                  <i class="fas fa-check"></i>
                </span>
              </p>

              <p
                *ngIf="selectedLogin"
                class="is-flex is-justify-content-space-between is-align-items-center"
              >
                <span>{{ VM.Login }}</span>
                <btn
                  [type_button]="'AnnulerSmallLight'"
                  (click)="selectedLogin=false; VM.mdp_requis=false"
                ></btn>
              </p>
            </div>

            <!-- Mot de passe -->
            <div *ngIf="VM.mdp_requis" class="field">
              <h6
                *ngIf="context == 'CREATE' && !VM.creer_compte"
                class="subtitle is-6 has-text-grey mb-2"
                i18n
              >
                Ce compte est protégé par un mot de passe, merci de saisir le
                mot de passe projet pour créer un adhérent sur ce compte.
              </h6>

              <label class="label is-small" for="loginPassword" i18n
                >Mot de passe</label
              >
              <p class="control has-icons-left has-icons-right">
                <input
                  id="loginPassword"
                  *ngIf="VM.mdp_requis"
                  [class]="VM.isPasswordValid ? 'input' : 'input is-danger'"
                  type="password"
                  placeholder="••••••••"
                  i18n-placeholder
                  [(ngModel)]="VM.Password"
                  (ngModelChange)="validatePassword($event)"
                  (keypress)="onKeyPress($event)"
                />
                <span class="icon is-small is-left">
                  <i class="fas fa-lock"></i>
                </span>
                <span
                  *ngIf="VM.isPasswordValid"
                  class="icon is-small is-right has-text-success"
                >
                  <i class="fas fa-check"></i>
                </span>
              </p>
              <p
                class="help is-danger"
                *ngIf="!VM.isPasswordValid"
                i18n
              >
                Le mot de passe doit contenir au moins 8 caractères et un
                nombre.
              </p>
            </div>

            <!-- Sélection projet -->
            <ng-container *ngIf="projets">
              <ng-container *ngIf="projets.length > 1">
                <div class="field">
                  <label for="projet" class="label is-small" i18n
                    >Projet</label
                  >
                  <div class="control">
                    <div class="select is-fullwidth">
                      <select
                        id="projet"
                        [(ngModel)]="projets_select"
                        i18n-placeholder
                      >
                        <option [ngValue]="null" selected i18n>
                          Aucune sélection
                        </option>
                        <ng-container *ngFor="let tt of projets">
                          <option [ngValue]="tt">{{ tt.nom }}</option>
                        </ng-container>
                      </select>
                    </div>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </section>

          <!-- BOUTONS D’ACTION -->
          <footer class="login-footer">
            <div class="columns">
              <div class="column">
                <!-- Cas standard (sans projets) -->
                <div class="field" *ngIf="!projets">
                  <p class="control stack-3">
                    <!-- Se connecter -->
                    <button
                      *ngIf="
                        (!store.isLoggedIn()) &&
                        !VM.creer_compte &&
                        !VM.mdp_requis
                      "
                      [disabled]="!VM.isValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="Login() && !VM.creer_compte"
                      i18n
                    >
                      Se connecter
                    </button>

                    <!-- Sélection compte (admin connecté) -->
                    <button
                      *ngIf="
                        (store.isLoggedIn()) &&
                        !VM.creer_compte &&
                        context == 'CREATE' &&
                        !VM.mdp_requis
                      "
                      [disabled]="!VM.isValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="Login() && !VM.creer_compte"
                      i18n
                    >
                      Selectionner ce compte
                    </button>

                    <!-- Sélection compte admin -->
                    <button
                      *ngIf="
                        (store.isLoggedIn()) &&
                        !VM.creer_compte &&
                        context == 'CREATE' &&
                        VM.mdp_requis
                      "
                      [disabled]="!VM.isValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="SelectionnerCompteAdmin()"
                      i18n
                    >
                      Selectionner ce compte en tant qu'admin
                    </button>

                    <!-- Création compte avec/sans mdp (non loggé) -->
                    <button
                      *ngIf="(!store.isLoggedIn()) && VM.creer_compte"
                      [disabled]="!VM.isPasswordValid || !VM.isLoginValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="CreerCompte(true)"
                      i18n
                    >
                      Créer un compte avec mot de passe
                    </button>

                    <button
                      *ngIf="(!store.isLoggedIn()) && VM.creer_compte"
                      [disabled]="!VM.isLoginValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="CreerCompte(false)"
                      i18n
                    >
                      Créer un compte sans mot de passe
                    </button>

                    <!-- Création compte (context CREATE) -->
                    <button
                      *ngIf="context == 'CREATE' && VM.creer_compte"
                      [disabled]="!VM.isPasswordValid || !VM.isLoginValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="CreerCompte(true)"
                      i18n
                    >
                      Créer un compte avec mot de passe
                    </button>

                    <button
                      *ngIf="context == 'CREATE' && VM.creer_compte"
                      [disabled]="!VM.isLoginValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="CreerCompte(false)"
                      i18n
                    >
                      Créer un compte sans mot de passe
                    </button>

                    <!-- Validation mdp -->
                    <button
                      *ngIf="
                        VM.mdp_requis &&
                        !store.isLoggedIn() &&
                        !VM.creer_compte
                      "
                      [disabled]="!VM.isValid"
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="Login() && !VM.creer_compte"
                      i18n
                    >
                      Valider le mot de passe
                    </button>

                    <!-- Lien réinitialisation -->
                    <button
                      *ngIf="
                        VM.isLoginValid &&
                        !VM.creer_compte &&
                        context != 'CREATE' &&
                        context != 'ESSAI'
                      "
                      type="button"
                      class="btn-link has-text-centered"
                      (click)="ReinitMDP()"
                      i18n
                    >
                      Réinitialiser le mot de passe
                    </button>
                  </p>
                </div>

                <!-- Cas avec projets -->
                <div class="field" *ngIf="projets">
                  <p class="control stack-3">
                    <button
                      class="button is-success is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="ConnectToProject()"
                      i18n
                    >
                      Se connecter au projet
                    </button>
                    <button
                      class="button is-danger is-light btn-mobile btn-elevated btn-lg btn-block-mobile"
                      (click)="LogOut()"
                      i18n
                    >
                      Se déconnecter
                    </button>
                  </p>
                </div>
              </div>
            </div>
          </footer>
        </div>
      </div>
    </div>
  </ng-container>
</div>
