<div class="container">
<ng-container *ngIf="loading && (!Liste || Liste.length === 0)">
  <progress class="progress is-large is-info" style="margin-top: 60px" max="100">60%</progress>
  <p>Chargement en cours</p>
</ng-container>
      <ng-container *ngIf="!(loading && (!Liste || Liste.length === 0))">
        <ng-container *ngIf="!Item; else lieuDetail">
          <div class="columns page-fill" *ngIf="Liste">
            <div class="column">
              <div class="card card--scroller">
               <header class="card-header" style="align-items: center">
  <p class="card-header-title" i18n>Liste des lieux</p>

  <span *ngIf="store.LieuHasRemoteNewerData()" class="tag is-warning is-light" style="margin-left: 10px">
    Nouvelles données dispo
  </span>

  <span *ngIf="needsReload" class="tag is-danger is-light" style="margin-left: 10px">
    Recharge conseillée
  </span>

  <span *ngIf="refreshing" class="tag is-info is-light" style="margin-left:10px">
    Mise à jour…
  </span>

  <btn *ngIf="store.LieuHasRemoteNewerData() || needsReload"
       [type_button]="'ReloadLight'"
       (click)="needsReload=false; RefreshLieu({apply:true})"></btn>
</header>

        <div class="card-content" #scrollableContent>
                  <div class="content">
            <table class="table" style="width: 100%;font-size:smaller" *ngIf="Liste && Liste.length> 0">
              <thead>
                <tr>
                  <th style="width: 2rem;">
  <input type="checkbox"
         [checked]="Liste?.length && selectedIds.size === Liste.length"
         (change)="toggleSelectAll($any($event.target).checked)" />
</th>

                  <th><span class="th_filtre">
                      <span class="ligne">
                        <span style="font-size: smaller;" i18n>Nom</span>
                        <span style="cursor: pointer;">
                          <i *ngIf="sort_nom === 'NO'" (click)="Sort('ASC', 'nom')" class="fa-solid fa-sort"></i>
                          <i *ngIf="sort_nom === 'ASC'" (click)="Sort('DESC', 'nom')" class="fa-solid fa-sort-up"></i>
                          <i *ngIf="sort_nom === 'DESC'" (click)="Sort('ASC', 'nom')" class="fa-solid fa-sort-down"></i>
                        </span>
                      </span>

                    </span>
                  </th>
                  <th><span class="th_filtre">
                      <span class="ligne">
                        <span style="font-size: smaller;" i18n>Adresse</span>
                      </span>
                    </span>
                  </th>
                  <th><span style="font-size: smaller;" i18n>Action</span></th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let lieu of Liste; trackBy: trackById">
                  <td style="width: 2rem;">
  <input type="checkbox"
         [checked]="isSelected(lieu.id)"
         (change)="toggleSelection(lieu.id, $any($event.target).checked)" />
</td>

                  <td>
                    {{lieu.nom}}
                  </td>
                  <td>
                    {{lieu.adresse.Street}}&nbsp;{{lieu.adresse.PostCode}}&nbsp;{{lieu.adresse.City}}                       
                  </td>
               
 <td>
                          <div class="buttons" style="flex-wrap: nowrap">
                            <btn
                              i18n-title
                              title="Supprimer"
                              [type_button]="'SupprimerLight'"
                              (click)="Delete(lieu)"
                            ></btn>

                            <btn
                              i18n-title
                              title="Editer"
                              [type_button]="'EditerLight'"
                              (click)="Edit(lieu)"
                            ></btn>
                          </div>
                        </td>
                </tr>
              </tbody>
            </table>
            <p *ngIf="!Liste || Liste.length ==0">Pas de lieu disponible</p>
          </div>
        </div>
     <footer class="card-footer">
                  <div class="columns">
                    <div class="column">
                       <ng-container *ngIf="hasSelection; else normalActions">
                        <span *ngIf="bulkWorking" class="tag is-info is-light" style="margin-left:10px">
  {{ bulkLabel || 'Traitement en cours…' }}
</span>
<div *ngIf="!bulkWorking" class="buttons" style="flex-wrap: nowrap">
      <btn title="Supprimer sélection"
           [type_button]="'SupprimerSmall'"
           (click)="supprimerListe()"></btn>

      <btn title="Copier sélection"
           [type_button]="'CopierSmall'"
           (click)="copierListe()"></btn>

      <btn title="Annuler sélection"
           [type_button]="'AnnulerSmall'"
           (click)="clearSelection()"></btn>
    </div>
                       </ng-container>
                       <ng-template #normalActions> 
                      <div *ngIf="!afficher_filtre" class="buttons">
                        <btn
                          [type_button]="'CreerSmall'"
                          (click)="Creer()"
                        ></btn>
                        <btn
                          [type_button]="'FiltrerSmall'"
                          (click)="
                            afficher_filtre
                              ? (afficher_filtre = false)
                              : (afficher_filtre = true)
                          "
                        ></btn>
                        <btn
                          [type_button]="'ExporterSmall'"
                          (click)="ExportExcel()"
                        ></btn>
                      </div>
  
                      <div class="buttons" *ngIf="afficher_filtre">
                        <btn
                         (click)="afficher_filtre = false; filter_nom = null; FiltrerListeLieu()"
                          [type_button]="'RetourLight'"
                        ></btn>
                        
                        <div
                          class="field is-horizontal"
                          style="gap: 0.5rem; align-items: center"
                        >
                          <div class="field-label is-normal">
                            <label class="label" style="white-space: nowrap" i18n
                              >Filtrer par nom - valeur du filtre :
                            </label>
                            <div class="field is-narrow">
                              <div class="control">
                                <input
                                  style="width: fit-content; font-size: smaller"
                                  class="input is-small"
                                  i18n-placeholder
                                  placeholder="Nom du lieu"
                                  type="text"
                                  (ngModelChange)="Filter($event)"
                                  [(ngModel)]="filter_nom"
                                />
                                </div>
                            </div>
                          </div>
                          <div class="tags">
                            <span
                              *ngIf="filter_nom"
                              class="tag is-success"
                            >
                              <span i18n>Nom : </span>
                              <span>{{ filter_nom }}</span>
                              <button
                                class="delete"
                                (click)="filter_nom = null; FiltrerListeLieu()"
                              ></button>
                            </span>
  
                           
                            <btn
 [type_button]="'SupprimerLight'"
  (click)="filter_nom = null; FiltrerListeLieu()"
  *ngIf="filter_nom">
                              
                            >
                            </btn>
                          </div>
                        </div>
                      </div>
</ng-template>

                    </div>
                  </div>
                </footer>
              </div>  
            </div>
          </div>
</ng-container>
<ng-template #lieuDetail>
  <div class="columns page-fill">
    <div class="column">
      <div class="card card--scroller">
        <!-- Header -->
        <header class="card-header" style="align-items:center">
                  <p class="card-header-title">
          <span *ngIf="Item.id==0" i18n>Créer un lieu</span>
          <span *ngIf="Item.id>0" i18n>Editer un lieu</span>
               </p>
          </header>     
                <!-- Content -->
        <div class="scrollable-card-content columns is-multiline is-variable is-3 p-3">

          <!-- Colonne gauche : champs Professor (entity exacte) -->
          <div class="column is-full-tablet is-half-desktop">
            <div class="box is-light">
    <div class="is-flex is-justify-content-space-between is-align-items-center mb-3">
      <h3 class="subtitle is-6 has-text-primary has-text-weight-semibold" i18n>Informations administratives</h3>  
              <ng-container *ngIf="Item.id>0">
      <btn *ngIf="!edit"
        [type_button]="'EditerLight'" 
        (click)="edit = !edit" 
      ></btn>
      <btn *ngIf="edit" [disabled]="Item.nom.length <5" (click)="Save(); edit = false;"
        [type_button]="'SauvegarderLight'">
      </btn> <btn *ngIf="edit" (click)="Cancel()"
        [type_button]="'AnnulerLight'">
      </btn>
      </ng-container>
      </div>
            <div class="field">
              <label class="label" i18n>Nom</label>
              <p *ngIf="!edit">{{Item.nom}}</p>
              <input *ngIf="edit" [class]="Item.nom.length>4 ? 'input' : 'input is-danger'" type="text" id="nom_rider"
                name="nom_rider" i18n-placeholder placeholder="Nom" [(ngModel)]="Item.nom" required>
              <p class="help is-danger" *ngIf="Item.nom.length <5" i18n>Le nom du lieu doit au moins faire 5
                caractères
              </p>
              
            </div>
            </div>
          </div>
            <div class="column is-full-tablet is-half-desktop">
                    <app-address
                                 [id]="Item.id"
                                 [thisAdresse]="Item.adresse"
                                 [Regles]="(GlobalService.getRegleLieuAdresse())"
                                 (InfoAdresseChange)="SaveAdresse($event)"
                                 (valid)="valid_adresse($event)"></app-address>                    
                  </div>
  </div>
       <footer class="card-footer">
          <div class="columns is-mobile is-centered">
            <div class="column is-half">
              <div class="buttons" style="flex-wrap:nowrap">
                <btn [type_button]="'RetourSmall'"  (click)="Retour()"></btn>
                <btn *ngIf="edit && Item.id<1" [type_button]="'SauvegarderSmall'" [disabled]="(Item.nom.length < 5 || !valid_address)" (click)="Save()" i18n>Sauvegarder</btn>          
          </div>
    </div>
  </div>
       </footer>
      </div>
      </div>
      </div>
</ng-template>