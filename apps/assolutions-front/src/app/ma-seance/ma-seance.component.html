<ng-container *ngIf="thisSeance">
  <!-- ====== DESKTOP / TABLET ====== -->
  <span class="fullscreen">
    <div class="columns page-fill">
      <div class="column">
        <div class="card">
          <header class="card-header" style="align-items: center">
            <p class="card-header-title">
              {{ thisSeance.libelle }}&nbsp;{{ seanceText }}
            </p>

            <!-- Actions à droite : bouton Options -->
            <div class="card-header-icon" style="gap:.5rem">
              <div class="dropdown" [class.is-active]="optionsOpen">
                <div class="dropdown-trigger">
                  <button class="button is-outlined is-primary is-rounded btn-compact"
                          aria-haspopup="true" aria-controls="dropdown-menu"
                          (click)="optionsOpen = !optionsOpen">
                    <span class="icon"><i class="fas fa-ellipsis-h"></i></span>
                    <span class="tablet">Options</span>
                  </button>
                </div>
                <div class="dropdown-menu" id="dropdown-menu" role="menu">
                  <div class="dropdown-content">
                    <a class="dropdown-item" (click)="openPanel('convocation')">
                      <i class="fas fa-paper-plane"></i>&nbsp;Envoyer convocation
                    </a>
                    <a class="dropdown-item" (click)="openPanel('annulation')">
                      <i class="fas fa-ban"></i>&nbsp;Envoyer annulation
                    </a>
                    <a class="dropdown-item" (click)="openPanel('ajout')">
                      <i class="fas fa-user-plus"></i>&nbsp;Ajouter une personne
                    </a>
                    <a class="dropdown-item" (click)="openPanel('note')">
                      <i class="fas fa-sticky-note"></i>&nbsp;Note séance
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </header>

          <!-- ====== CARD CONTENT ====== -->
          <div class="card-content" #scrollableContent>
            <div class="content">

              <!-- ====== PANNEAUX D'OPTIONS (remplacent la liste) ====== -->
              <ng-container *ngIf="uiMode !== 'list'">
                <!-- Toolbar locale du panneau -->
                <div class="ms-panel-toolbar">
                  <button class="button is-light is-rounded btn-compact"
                          (click)="closePanel()">
                    <span class="icon"><i class="fas fa-arrow-left"></i></span>
                    <span>Retour</span>
                  </button>

                  <span class="ms-panel-title" *ngIf="uiMode==='convocation'">
                    <i class="fas fa-paper-plane"></i>&nbsp;Convocation
                  </span>
                  <span class="ms-panel-title" *ngIf="uiMode==='annulation'">
                    <i class="fas fa-ban"></i>&nbsp;Annulation
                  </span>
                  <span class="ms-panel-title" *ngIf="uiMode==='ajout'">
                    <i class="fas fa-user-plus"></i>&nbsp;Ajouter une personne
                  </span>
                  <span class="ms-panel-title" *ngIf="uiMode==='note'">
                    <i class="fas fa-sticky-note"></i>&nbsp;Note séance
                  </span>
                </div>

                <!-- CONVOCATION -->
                <div *ngIf="uiMode==='convocation'" class="ms-panel">
                  <div class="ms-form grid-2">
                    <div>
                      <label class="label">Destinataires</label>
                      <div class="ms-recipients">
                        <label class="checkbox" *ngFor="let p of All">
                          <input type="checkbox"
                                 [checked]="isChecked(p, 'convocation')"
                                 (change)="toggleRecipient(p, 'convocation', $any($event.target).checked)">
                          <span class="ms-rec-name">{{ p.person.libelle }}</span>
                          <span class="tag is-light ms-badge" *ngIf="p.statut_inscription">
                            {{ p.statut_inscription }}
                          </span>
                        </label>
                      </div>
                      <div class="buttons is-right mt-2">
                        <button class="button is-small is-light"
                                (click)="checkAll('convocation', true)">Tout sélectionner</button>
                        <button class="button is-small is-light"
                                (click)="checkAll('convocation', false)">Tout désélectionner</button>
                      </div>
                    </div>

                    <div>
                      <label class="label">Sujet</label>
                      <input class="input" [(ngModel)]="mailSubject" />
                      <label class="label mt-2">Message</label>
                      <textarea class="textarea" rows="10" [(ngModel)]="mailBody"></textarea>

                      <div class="buttons is-right mt-3">
                        <button class="button is-primary"
                                [disabled]="!selectedRecipients.length"
                                (click)="sendMail('convocation')">
                          <i class="fas fa-paper-plane"></i>&nbsp;Envoyer
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ANNULATION -->
                <div *ngIf="uiMode==='annulation'" class="ms-panel">
                  <div class="ms-form grid-2">
                    <div>
                      <label class="label">Destinataires</label>
                      <div class="ms-recipients">
                        <label class="checkbox" *ngFor="let p of All">
                          <input type="checkbox"
                                 [checked]="isChecked(p, 'annulation')"
                                 (change)="toggleRecipient(p, 'annulation', $any($event.target).checked)">
                          <span class="ms-rec-name">{{ p.person.libelle }}</span>
                          <span class="tag is-light ms-badge" *ngIf="p.statut_inscription">
                            {{ p.statut_inscription }}
                          </span>
                        </label>
                      </div>
                      <div class="buttons is-right mt-2">
                        <button class="button is-small is-light"
                                (click)="checkAll('annulation', true)">Tout sélectionner</button>
                        <button class="button is-small is-light"
                                (click)="checkAll('annulation', false)">Tout désélectionner</button>
                      </div>
                    </div>

                    <div>
                      <label class="label">Sujet</label>
                      <input class="input" [(ngModel)]="mailSubject" />
                      <label class="label mt-2">Message</label>
                      <textarea class="textarea" rows="10" [(ngModel)]="mailBody"></textarea>

                      <div class="buttons is-right mt-3">
                        <button class="button is-danger"
                                [disabled]="!selectedRecipients.length"
                                (click)="sendMail('annulation')">
                          <i class="fas fa-paper-plane"></i>&nbsp;Envoyer
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- AJOUT PERSONNE -->
                <div *ngIf="uiMode==='ajout'" class="ms-panel">
                  <div class="field is-horizontal" style="gap:.75rem; align-items:center;">
                    <div class="field-label is-normal">
                      <label class="label" style="white-space: nowrap">Sélection adhérent</label>
                    </div>
                    <div class="field-body">
                      <div class="field is-narrow">
                        <div class="control">
                          <div class="select is-fullwidth">
                            <select [(ngModel)]="adherent_to">
                              <ng-container *ngFor="let add of Autres">
                                <option [ngValue]="add">{{ add.libelle }}</option>
                              </ng-container>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                    <button class="button is-primary"
                            [disabled]="!adherent_to"
                            (click)="AjouterAdherentsHorsGroupe(); closePanel()">
                      <i class="fas fa-user-plus"></i>&nbsp;Ajouter
                    </button>
                  </div>
                </div>

                <!-- NOTE SÉANCE -->
                <div *ngIf="uiMode==='note'" class="ms-panel">
                  <label class="label">Info séance</label>
                  <textarea class="textarea" rows="8"
                            [(ngModel)]="thisSeance.info_seance"></textarea>
                  <div class="buttons is-right mt-3">
                    <button class="button is-link" (click)="saveInfoSeance()">Enregistrer</button>
                  </div>
                </div>
              </ng-container>

              <!-- ====== LISTES (mode normal) ====== -->
              <ng-container *ngIf="uiMode === 'list'">

                <!-- Présences potentielles -->
                <h6 class="title is-6" style="cursor:pointer;"
                    (click)="display_personne = !display_personne">
                  <i class="fas"
                     [ngClass]="display_personne ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                  &nbsp;<span i18n>Présences potentielles</span>&nbsp;({{ All.length }}&nbsp;<span i18n>personnes</span>)
                </h6>

                <span *ngIf="display_personne">
                <ng-container *ngFor="let potentiel of All">
                  <ng-container *ngIf="!potentiel.statut_seance">
                    <ng-container *ngIf="potentiel.statut_inscription === 'présent'" >
                      <div class="ligne">
                                                <span class="partie1">
                          <span class="icon is-medium">
                            <span
                              class="fa-stack fa-sm"     (click)="openMenu(potentiel, $event)"
                              (click)="potentiel.isVisible = true"
                            >
                              <i class="fas fa-stack-2x fa-thumbs-up has-text-success" ></i>
                            </span>
                          </span>
                          <ul
                            class="menu-icons"
                            [ngClass]="{
                              'is-visible': potentiel.isVisible,
                              not: !potentiel.isVisible
                            }"
    (click)="$event.stopPropagation()">
                            <li (click)="setStatusAndClose('présent', potentiel, $event)">
    <i class="fas fa-thumbs-up"></i> Présent
  </li>
  <li (click)="setStatusAndClose('absent', potentiel, $event)">
    <i class="fas fa-thumbs-down"></i> Absent
  </li>
  <li (click)="setStatusAndClose('essai', potentiel, $event)">
    <i class="fas fa-question"></i> Essai
  </li>
  <li (click)="setStatusAndClose('convoqué', potentiel, $event)">
    <i class="fas fa-hand-point-up"></i> Convoqué
  </li>
  <li (click)="setStatusAndClose(null, potentiel, $event)">
    <i class="fas fa-ellipsis-h"></i> Non défini
  </li>
                          </ul>
                          <span class="nom_personne">{{
                            potentiel.person.libelle
                          }}</span>
                          <span [title]="contact_urgence_nom(potentiel)">{{
                            contact_urgence(potentiel)
                          }}</span>
                        </span>
                        <div class="buttons has-addons">
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-primary"
                            (click)="MAJInscription(potentiel, true)"
                            [disabled]="!GetNbPersonne(Presents)"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-danger"
                            (click)="MAJInscription(potentiel, false)"
                          >
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-container *ngFor="let potentiel of All">
                  <ng-container *ngIf="!potentiel.statut_seance">
                    <ng-container *ngIf="potentiel.statut_inscription === 'essai'"  >
                      <div class="ligne">
                        <span class="partie1">
                          <span class="icon is-medium">
                            <span
                              class="fa-stack fa-sm"     (click)="openMenu(potentiel, $event)"
                              (click)="potentiel.isVisible = true"
                            >
                              <i class="fas fa-stack-2x fa-question"></i>
                            </span>
                          </span>
                          <ul
                            class="menu-icons"
                            [ngClass]="{
                              'is-visible': potentiel.isVisible,
                              not: !potentiel.isVisible
                            }"
    (click)="$event.stopPropagation()">
                            <li (click)="setStatusAndClose('présent', potentiel, $event)">
    <i class="fas fa-thumbs-up"></i> Présent
  </li>
  <li (click)="setStatusAndClose('absent', potentiel, $event)">
    <i class="fas fa-thumbs-down"></i> Absent
  </li>
  <li (click)="setStatusAndClose('essai', potentiel, $event)">
    <i class="fas fa-question"></i> Essai
  </li>
  <li (click)="setStatusAndClose('convoqué', potentiel, $event)">
    <i class="fas fa-hand-point-up"></i> Convoqué
  </li>
  <li (click)="setStatusAndClose(null, potentiel, $event)">
    <i class="fas fa-ellipsis-h"></i> Non défini
  </li>
                          </ul>
                          <span class="nom_personne">{{
                            potentiel.person.libelle
                          }}</span>
                          <span [title]="contact_urgence_nom(potentiel)">{{
                            contact_urgence(potentiel)
                          }}</span>
                        </span>
                        <div class="buttons has-addons">
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-primary"
                            (click)="MAJInscription(potentiel, true)"
                            [disabled]="!GetNbPersonne(Presents)"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-danger"
                            (click)="MAJInscription(potentiel, false)"
                          >
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-container *ngFor="let potentiel of All">
                  <ng-container *ngIf="!potentiel.statut_seance">
                    <ng-container *ngIf="potentiel.statut_inscription === 'convoqué'" >
                      <div class="ligne">
                        <span class="partie1">
                          <span class="icon is-medium">
                            <span
                              class="fa-stack fa-sm"     (click)="openMenu(potentiel, $event)"
                              (click)="potentiel.isVisible = true"
                            >
                              <i  class="fas fa-stack-2x fa-hand-point-up has-text-info"></i>
                            </span>
                          </span>
                          <ul
                            class="menu-icons"
                            [ngClass]="{
                              'is-visible': potentiel.isVisible,
                              not: !potentiel.isVisible
                            }"
    (click)="$event.stopPropagation()">
                            <li (click)="setStatusAndClose('présent', potentiel, $event)">
    <i class="fas fa-thumbs-up"></i> Présent
  </li>
  <li (click)="setStatusAndClose('absent', potentiel, $event)">
    <i class="fas fa-thumbs-down"></i> Absent
  </li>
  <li (click)="setStatusAndClose('essai', potentiel, $event)">
    <i class="fas fa-question"></i> Essai
  </li>
  <li (click)="setStatusAndClose('convoqué', potentiel, $event)">
    <i class="fas fa-hand-point-up"></i> Convoqué
  </li>
  <li (click)="setStatusAndClose(null, potentiel, $event)">
    <i class="fas fa-ellipsis-h"></i> Non défini
  </li>
                          </ul>
                          <span class="nom_personne">{{
                            potentiel.person.libelle
                          }}</span>
                          <span [title]="contact_urgence_nom(potentiel)">{{
                            contact_urgence(potentiel)
                          }}</span>
                        </span>
                        <div class="buttons has-addons">
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-primary"
                            (click)="MAJInscription(potentiel, true)"
                            [disabled]="!GetNbPersonne(Presents)"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-danger"
                            (click)="MAJInscription(potentiel, false)"
                          >
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-container *ngFor="let potentiel of All">
                  <ng-container *ngIf="!potentiel.statut_seance">
                    <ng-container *ngIf="potentiel.statut_inscription === 'absent'" >
                      <div class="ligne">
                            <span class="partie1">
                          <span class="icon is-medium">
                            <span
                              class="fa-stack fa-sm"     (click)="openMenu(potentiel, $event)"
                              (click)="potentiel.isVisible = true"
                            >
                              <i  class="fas fa-stack-2x fa-thumbs-down has-text-danger"></i>
                            </span>
                          </span>
                          <ul
                            class="menu-icons"
                            [ngClass]="{
                              'is-visible': potentiel.isVisible,
                              not: !potentiel.isVisible
                            }"
    (click)="$event.stopPropagation()">
                            <li (click)="setStatusAndClose('présent', potentiel, $event)">
    <i class="fas fa-thumbs-up"></i> Présent
  </li>
  <li (click)="setStatusAndClose('absent', potentiel, $event)">
    <i class="fas fa-thumbs-down"></i> Absent
  </li>
  <li (click)="setStatusAndClose('essai', potentiel, $event)">
    <i class="fas fa-question"></i> Essai
  </li>
  <li (click)="setStatusAndClose('convoqué', potentiel, $event)">
    <i class="fas fa-hand-point-up"></i> Convoqué
  </li>
  <li (click)="setStatusAndClose(null, potentiel, $event)">
    <i class="fas fa-ellipsis-h"></i> Non défini
  </li>
                          </ul>
                          <span class="nom_personne">{{
                            potentiel.person.libelle
                          }}</span>
                          <span [title]="contact_urgence_nom(potentiel)">{{
                            contact_urgence(potentiel)
                          }}</span>
                        </span>
                        <div class="buttons has-addons">
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-primary"
                            (click)="MAJInscription(potentiel, true)"
                            [disabled]="!GetNbPersonne(Presents)"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-danger"
                            (click)="MAJInscription(potentiel, false)"
                          >
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-container *ngFor="let potentiel of All">
                  <ng-container *ngIf="!potentiel.statut_seance">
                    <ng-container *ngIf="!potentiel.statut_inscription">
                      <div class="ligne">
                                                    <span class="partie1">
                          <span class="icon is-medium">
                            <span
                              class="fa-stack fa-sm"     (click)="openMenu(potentiel, $event)"
                              (click)="potentiel.isVisible = true"
                            >
                              <i  class="fas fa-stack-2x fa-ellipsis-h"></i>
                            </span>
                          </span>
                          <ul
                            class="menu-icons"
                            [ngClass]="{
                              'is-visible': potentiel.isVisible,
                              not: !potentiel.isVisible
                            }"
    (click)="$event.stopPropagation()">
                            <li (click)="setStatusAndClose('présent', potentiel, $event)">
    <i class="fas fa-thumbs-up"></i> Présent
  </li>
  <li (click)="setStatusAndClose('absent', potentiel, $event)">
    <i class="fas fa-thumbs-down"></i> Absent
  </li>
  <li (click)="setStatusAndClose('essai', potentiel, $event)">
    <i class="fas fa-question"></i> Essai
  </li>
  <li (click)="setStatusAndClose('convoqué', potentiel, $event)">
    <i class="fas fa-hand-point-up"></i> Convoqué
  </li>
  <li (click)="setStatusAndClose(null, potentiel, $event)">
    <i class="fas fa-ellipsis-h"></i> Non défini
  </li>
                          </ul>
                          <span class="nom_personne">{{
                            potentiel.person.libelle
                          }}</span>
                          <span [title]="contact_urgence_nom(potentiel)">{{
                            contact_urgence(potentiel)
                          }}</span>
                        </span>
                        <div class="buttons has-addons">
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-primary"
                            (click)="MAJInscription(potentiel, true)"
                            [disabled]="!GetNbPersonne(Presents)"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button
                            type="button"
                            class="button is-outlined is-rounded is-danger"
                            (click)="MAJInscription(potentiel, false)"
                          >
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
                </span>

                <!-- Présents -->
                <h6 class="title is-6" style="cursor:pointer;"
                    (click)="display_present = !display_present">
                  <i class="fas"
                     [ngClass]="display_present ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                  &nbsp;<span i18n>Présents</span>&nbsp;({{ Presents.length }}&nbsp;<span i18n>personnes</span>)
                </h6>
                <span *ngIf="display_present">
                  <!-- garde ton bloc Présents inchangé -->
                </span>

                <!-- Absents -->
                <h6 class="title is-6" style="cursor:pointer;"
                    (click)="display_absent = !display_absent">
                  <i class="fas"
                     [ngClass]="display_absent ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                  &nbsp;<span i18n>Absents</span>&nbsp;({{ Absents.length }}&nbsp;<span i18n>personnes</span>)
                </h6>
                <span *ngIf="display_absent">
                  <!-- garde ton bloc Absents inchangé -->
                </span>

                <button class="scroll-to-top"
                        *ngIf="showScrollToTop"
                        (click)="scrollToTop()"
                        title="Revenir en haut">↑</button>
              </ng-container>
            </div>
          </div>

          <!-- ====== FOOTER Desktop ====== -->
          <footer class="card-footer">
            <div class="columns">
              <div class="column">
                <div class="buttons">
                  <btn [type_button]="'RetourSmall'" (click)="RetourListe()"></btn>

                  <!-- On épure : l’ajout passe aussi par Options, on garde quand même ci-dessous si tu veux -->
                  <div class="field is-horizontal">
                    <div class="field-label is-normal is-two-quarter">
                      <label class="label" style="white-space: nowrap" i18n>Ajouter un adhérent à la séance</label>
                    </div>
                    <div class="field-body">
                      <div class="field is-narrow">
                        <div class="control">
                          <div class="select is-fullwidth">
                            <select [(ngModel)]="adherent_to">
                              <ng-container *ngFor="let add of Autres">
                                <option [ngValue]="add">{{ add.libelle }}</option>
                              </ng-container>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                    <btn [type_button]="'AjouterSmall'"
                         [disabled]="!adherent_to"
                         (click)="AjouterAdherentsHorsGroupe()"></btn>
                  </div>

                </div>
              </div>
            </div>
          </footer>
        </div>
      </div>
    </div>
  </span>

  <!-- ====== MOBILE ====== -->
  <span class="mobile">
    <div class="container-box">
      <nav class="navbar is-fixed-top">
        <btn [type_button]="'RetourMobile'" (click)="uiMode!=='list' ? closePanel() : RetourListe()"></btn>
        <button class="button is-outlined is-primary btn-mobile btn-elevated"
                (click)="toggleMobileOptions = !toggleMobileOptions">
          <i class="fas fa-ellipsis-h"></i>&nbsp;<span>Options</span>
        </button>
        <div class="dropdown is-right" [class.is-active]="toggleMobileOptions">
          <div class="dropdown-menu">
            <div class="dropdown-content">
              <a class="dropdown-item" (click)="openPanel('convocation'); toggleMobileOptions=false">Envoyer convocation</a>
              <a class="dropdown-item" (click)="openPanel('annulation'); toggleMobileOptions=false">Envoyer annulation</a>
              <a class="dropdown-item" (click)="openPanel('ajout'); toggleMobileOptions=false">Ajouter une personne</a>
              <a class="dropdown-item" (click)="openPanel('note'); toggleMobileOptions=false">Note séance</a>
            </div>
          </div>
        </div>
      </nav>

      <p class="title is-5" style="margin-top:.5rem;">
        {{ thisSeance.libelle }}&nbsp;{{ seanceText }}
      </p>

      <!-- Contenu mobile : panneau d’options OU listes -->
      <ng-container *ngIf="uiMode !== 'list'">
        <!-- On réutilise les mêmes panneaux que desktop (markup identique) -->
        <div class="ms-panel-toolbar">
          <button class="button is-light is-rounded btn-compact" (click)="closePanel()">
            <span class="icon"><i class="fas fa-arrow-left"></i></span>
            <span>Retour</span>
          </button>
          <span class="ms-panel-title" *ngIf="uiMode==='convocation'"><i class="fas fa-paper-plane"></i>&nbsp;Convocation</span>
          <span class="ms-panel-title" *ngIf="uiMode==='annulation'"><i class="fas fa-ban"></i>&nbsp;Annulation</span>
          <span class="ms-panel-title" *ngIf="uiMode==='ajout'"><i class="fas fa-user-plus"></i>&nbsp;Ajouter une personne</span>
          <span class="ms-panel-title" *ngIf="uiMode==='note'"><i class="fas fa-sticky-note"></i>&nbsp;Note séance</span>
        </div>

        <div *ngIf="uiMode==='convocation'" class="ms-panel">
          <!-- même contenu que desktop -->
          <div class="ms-form grid-1">
            <div>
              <label class="label">Destinataires</label>
              <div class="ms-recipients">
                <label class="checkbox" *ngFor="let p of All">
                  <input type="checkbox"
                         [checked]="isChecked(p, 'convocation')"
                         (change)="toggleRecipient(p, 'convocation', $any($event.target).checked)">
                  <span class="ms-rec-name">{{ p.person.libelle }}</span>
                  <span class="tag is-light ms-badge" *ngIf="p.statut_inscription">{{ p.statut_inscription }}</span>
                </label>
              </div>
              <div class="buttons is-right mt-2">
                <button class="button is-small is-light" (click)="checkAll('convocation', true)">Tout sélectionner</button>
                <button class="button is-small is-light" (click)="checkAll('convocation', false)">Tout désélectionner</button>
              </div>
            </div>
            <div>
              <label class="label">Sujet</label>
              <input class="input" [(ngModel)]="mailSubject" />
              <label class="label mt-2">Message</label>
              <textarea class="textarea" rows="10" [(ngModel)]="mailBody"></textarea>
              <div class="buttons is-right mt-3">
                <button class="button is-primary" [disabled]="!selectedRecipients.length"
                        (click)="sendMail('convocation')">
                  <i class="fas fa-paper-plane"></i>&nbsp;Envoyer
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="uiMode==='annulation'" class="ms-panel">
          <!-- même contenu que desktop -->
          <div class="ms-form grid-1">
            <!-- … identique au bloc convocation, en remplaçant le preset par annulation … -->
            <div>
              <label class="label">Destinataires</label>
              <div class="ms-recipients">
                <label class="checkbox" *ngFor="let p of All">
                  <input type="checkbox"
                         [checked]="isChecked(p, 'annulation')"
                        (change)="toggleRecipient(p, 'annulation', $any($event.target).checked)">
                  <span class="ms-rec-name">{{ p.person.libelle }}</span>
                  <span class="tag is-light ms-badge" *ngIf="p.statut_inscription">{{ p.statut_inscription }}</span>
                </label>
              </div>
              <div class="buttons is-right mt-2">
                <button class="button is-small is-light" (click)="checkAll('annulation', true)">Tout sélectionner</button>
                <button class="button is-small is-light" (click)="checkAll('annulation', false)">Tout désélectionner</button>
              </div>
            </div>
            <div>
              <label class="label">Sujet</label>
              <input class="input" [(ngModel)]="mailSubject" />
              <label class="label mt-2">Message</label>
              <textarea class="textarea" rows="10" [(ngModel)]="mailBody"></textarea>
              <div class="buttons is-right mt-3">
                <button class="button is-danger" [disabled]="!selectedRecipients.length"
                        (click)="sendMail('annulation')">
                  <i class="fas fa-paper-plane"></i>&nbsp;Envoyer
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="uiMode==='ajout'" class="ms-panel">
          <!-- même contenu que desktop -->
          <div class="field is-horizontal" style="gap:.75rem; align-items:center;">
            <div class="field-label is-normal">
              <label class="label" style="white-space: nowrap">Sélection adhérent</label>
            </div>
            <div class="field-body">
              <div class="field is-narrow">
                <div class="control">
                  <div class="select is-fullwidth">
                    <select [(ngModel)]="adherent_to">
                      <ng-container *ngFor="let add of Autres">
                        <option [ngValue]="add">{{ add.libelle }}</option>
                      </ng-container>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <button class="button is-primary"
                    [disabled]="!adherent_to"
                    (click)="AjouterAdherentsHorsGroupe(); closePanel()">
              <i class="fas fa-user-plus"></i>&nbsp;Ajouter
            </button>
          </div>
        </div>

        <div *ngIf="uiMode==='note'" class="ms-panel">
          <label class="label">Info séance</label>
          <textarea class="textarea" rows="8" [(ngModel)]="thisSeance.info_seance"></textarea>
          <div class="buttons is-right mt-3">
            <button class="button is-link" (click)="saveInfoSeance()">Enregistrer</button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="uiMode === 'list'">
          <ng-container *ngFor="let potentiel of All">
        <ng-container *ngIf="!potentiel.statut_seance">
          <ng-container
            *ngIf="potentiel.statut_inscription === 'présent'"
          >
            <div class="ligne">
              <span class="partie1">
                <span class="icon is-medium">
                  <span
                    class="fa-stack fa-sm"
                    (click)="potentiel.isVisible = true"
                  >
                    <i
                      class="fas fa-stack-2x fa-thumbs-up has-text-success"
                    ></i>
                  </span>
                </span>
                <ul
                  class="menu-icons"
                  [ngClass]="{
                    'is-visible': potentiel.isVisible,
                    not: !potentiel.isVisible
                  }"
                >
                  <li (click)="setStatus('présent', potentiel)">
                    <i class="fas fa-thumbs-up"></i> Présent
                  </li>
                  <li (click)="setStatus('absent', potentiel)">
                    <i class="fas fa-thumbs-down"></i> Absent
                  </li>
                  <li (click)="setStatus('essai', potentiel)">
                    <i class="fas fa-question"></i> Essai
                  </li>
                  <li (click)="setStatus('convoqué', potentiel)">
                    <i class="fas fa-hand-point-up"></i> Convoqué
                  </li>
                  <li (click)="setStatus(null, potentiel)">
                    <i class="fas fa-ellipsis-h"></i> Non défini
                  </li>
                </ul>
                <span class="nom_personne">{{
                  potentiel.person.libelle
                }}</span>
                <span [title]="contact_urgence_nom(potentiel)">{{
                  contact_urgence(potentiel)
                }}</span>
              </span>
              <div class="buttons has-addons">
                <button
                  type="button"
                  class="button is-outlined is-rounded is-primary"
                  (click)="MAJInscription(potentiel, true)"
                  [disabled]="!GetNbPersonne(Presents)"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button
                  type="button"
                  class="button is-outlined is-rounded is-danger"
                  (click)="MAJInscription(potentiel, false)"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let potentiel of All">
        <ng-container *ngIf="!potentiel.statut_seance">
          <ng-container
            *ngIf="potentiel.statut_inscription === 'essai'"
          >
            <div class="ligne">
              <span class="partie1">
                <span class="icon is-medium">
                  <span
                    class="fa-stack fa-sm"
                    (click)="potentiel.isVisible = true"
                  >
                    <i class="fas fa-stack-2x fa-question"></i>
                  </span>
                </span>
                <ul
                  class="menu-icons"
                  [ngClass]="{
                    'is-visible': potentiel.isVisible,
                    not: !potentiel.isVisible
                  }"
                >
                  <li (click)="setStatus('présent', potentiel)">
                    <i class="fas fa-thumbs-up"></i> Présent
                  </li>
                  <li (click)="setStatus('absent', potentiel)">
                    <i class="fas fa-thumbs-down"></i> Absent
                  </li>
                  <li (click)="setStatus('essai', potentiel)">
                    <i class="fas fa-question"></i> Essai
                  </li>
                  <li (click)="setStatus('convoqué', potentiel)">
                    <i class="fas fa-hand-point-up"></i> Convoqué
                  </li>
                  <li (click)="setStatus(null, potentiel)">
                    <i class="fas fa-ellipsis-h"></i> Non défini
                  </li>
                </ul>
                <span class="nom_personne">{{
                  potentiel.person.libelle
                }}</span>
                <span [title]="contact_urgence_nom(potentiel)">{{
                  contact_urgence(potentiel)
                }}</span>
              </span>
              <div class="buttons has-addons">
                <button
                  type="button"
                  class="button is-outlined is-rounded is-primary"
                  (click)="MAJInscription(potentiel, true)"
                  [disabled]="!GetNbPersonne(Presents)"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button
                  type="button"
                  class="button is-outlined is-rounded is-danger"
                  (click)="MAJInscription(potentiel, false)"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let potentiel of All">
        <ng-container *ngIf="!potentiel.statut_seance">
          <ng-container
            *ngIf="potentiel.statut_inscription === 'convoqué'"
          >
            <div class="ligne">
              <span class="partie1">
                <span class="icon is-medium">
                  <span
                    class="fa-stack fa-sm"
                    (click)="potentiel.isVisible = true"
                  >
                    <i
                      class="fas fa-stack-2x fa-hand-point-up has-text-info"
                    ></i>
                  </span>
                </span>
                <ul
                  class="menu-icons"
                  [ngClass]="{
                    'is-visible': potentiel.isVisible,
                    not: !potentiel.isVisible
                  }"
                >
                  <li (click)="setStatus('présent', potentiel)">
                    <i class="fas fa-thumbs-up"></i> Présent
                  </li>
                  <li (click)="setStatus('absent', potentiel)">
                    <i class="fas fa-thumbs-down"></i> Absent
                  </li>
                  <li (click)="setStatus('essai', potentiel)">
                    <i class="fas fa-question"></i> Essai
                  </li>
                  <li (click)="setStatus('convoqué', potentiel)">
                    <i class="fas fa-hand-point-up"></i> Convoqué
                  </li>
                  <li (click)="setStatus(null, potentiel)">
                    <i class="fas fa-ellipsis-h"></i> Non défini
                  </li>
                </ul>
                <span class="nom_personne">{{
                  potentiel.person.libelle
                }}</span>
                <span [title]="contact_urgence_nom(potentiel)">{{
                  contact_urgence(potentiel)
                }}</span>
              </span>
              <div class="buttons has-addons">
                <button
                  type="button"
                  class="button is-outlined is-rounded is-primary"
                  (click)="MAJInscription(potentiel, true)"
                  [disabled]="!GetNbPersonne(Presents)"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button
                  type="button"
                  class="button is-outlined is-rounded is-danger"
                  (click)="MAJInscription(potentiel, false)"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let potentiel of All">
        <ng-container *ngIf="!potentiel.statut_seance">
          <ng-container
            *ngIf="potentiel.statut_inscription === 'absent'"
          >
            <div class="ligne">
              <span class="partie1">
                <span class="icon is-medium">
                  <span
                    class="fa-stack fa-sm"
                    (click)="potentiel.isVisible = true"
                  >
                    <i
                      class="fas fa-stack-2x fa-thumbs-down has-text-danger"
                    ></i>
                  </span>
                </span>
                <ul
                  class="menu-icons"
                  [ngClass]="{
                    'is-visible': potentiel.isVisible,
                    not: !potentiel.isVisible
                  }"
                >
                  <li (click)="setStatus('présent', potentiel)">
                    <i class="fas fa-thumbs-up"></i> Présent
                  </li>
                  <li (click)="setStatus('absent', potentiel)">
                    <i class="fas fa-thumbs-down"></i> Absent
                  </li>
                  <li (click)="setStatus('essai', potentiel)">
                    <i class="fas fa-question"></i> Essai
                  </li>
                  <li (click)="setStatus('convoqué', potentiel)">
                    <i class="fas fa-hand-point-up"></i> Convoqué
                  </li>
                  <li (click)="setStatus(null, potentiel)">
                    <i class="fas fa-ellipsis-h"></i> Non défini
                  </li>
                </ul>
                <span class="nom_personne">{{
                  potentiel.person.libelle
                }}</span>
                <span [title]="contact_urgence_nom(potentiel)">{{
                  contact_urgence(potentiel)
                }}</span>
              </span>
              <div class="buttons has-addons">
                <button
                  type="button"
                  class="button is-outlined is-rounded is-primary"
                  (click)="MAJInscription(potentiel, true)"
                  [disabled]="!GetNbPersonne(Presents)"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button
                  type="button"
                  class="button is-outlined is-rounded is-danger"
                  (click)="MAJInscription(potentiel, false)"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let potentiel of All">
        <ng-container *ngIf="!potentiel.statut_seance">
          <ng-container *ngIf="potentiel.statut_inscription === null">
            <div class="ligne">
              <span class="partie1">
                <span class="icon is-medium">
                  <span
                    class="fa-stack fa-sm"
                    (click)="potentiel.isVisible = true"
                  >
                    <i class="fas fa-stack-2x fa-ellipsis-h"></i>
                  </span>
                </span>
                <ul
                  class="menu-icons"
                  [ngClass]="{
                    'is-visible': potentiel.isVisible,
                    not: !potentiel.isVisible
                  }"
                >
                  <li (click)="setStatus('présent', potentiel)">
                    <i class="fas fa-thumbs-up"></i> Présent
                  </li>
                  <li (click)="setStatus('absent', potentiel)">
                    <i class="fas fa-thumbs-down"></i> Absent
                  </li>
                  <li (click)="setStatus('essai', potentiel)">
                    <i class="fas fa-question"></i> Essai
                  </li>
                  <li (click)="setStatus('convoqué', potentiel)">
                    <i class="fas fa-hand-point-up"></i> Convoqué
                  </li>
                  <li (click)="setStatus(null, potentiel)">
                    <i class="fas fa-ellipsis-h"></i> Non défini
                  </li>
                </ul>
                <span class="nom_personne">{{
                  potentiel.person.libelle
                }}</span>
                <span [title]="contact_urgence_nom(potentiel)">{{
                  contact_urgence(potentiel)
                }}</span>
              </span>
              <div class="buttons has-addons">
                <button
                  type="button"
                  class="button is-outlined is-rounded is-primary"
                  (click)="MAJInscription(potentiel, true)"
                  [disabled]="!GetNbPersonne(Presents)"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button
                  type="button"
                  class="button is-outlined is-rounded is-danger"
                  (click)="MAJInscription(potentiel, false)"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
      </ng-container>
    </div>
  </span>
</ng-container>
